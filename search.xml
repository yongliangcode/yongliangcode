<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>MQ1# RocketMQ Connection命令</title>
    <url>/posts/6957c801/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="消费端连接信息"><a href="#消费端连接信息" class="headerlink" title="消费端连接信息"></a>消费端连接信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin consumerConnection -g T_SCANRECORD_NEW_GROUP -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">001 127.0.0.1@60190 192.168.2.x:50104 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">002 127.0.0.1@7454 192.168.7.x:27692 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">003 127.0.0.1@31600 192.168.21.x:40243 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">004 127.0.0.1@21322 192.168.21.x:31416 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">005 127.0.0.1@39557 192.168.2.x:45959 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">006 127.0.0.1@24765 192.168.7.x:15166 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">007 127.0.0.1@26993 192.168.7.x:57864 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">008 127.0.0.1@652 192.168.21.x:59261 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">009 127.0.0.1@10388 192.168.21.x:1671 JAVA V3_2_6_SNAPSHOT</span><br><span class="line"></span><br><span class="line">Below is subscription:001 Topic: %RETRY%T_SCANRECORD_NEW_GROUP SubExpression: *</span><br><span class="line"></span><br><span class="line">002 Topic: T_SCANRECORD_NEW SubExpression: 1||2||3||4 || 5 || -5||7 || 45</span><br><span class="line"></span><br><span class="line">ConsumeType: CONSUME_PASSIVELY</span><br><span class="line"></span><br><span class="line">MessageModel: CLUSTERING</span><br><span class="line"></span><br><span class="line">ConsumeFromWhere: CONSUME_FROM_FIRST_OFFSET</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="生产连接信息"><a href="#生产连接信息" class="headerlink" title="生产连接信息"></a>生产连接信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin producerConnection -t T_SCANRECORD_NEW -g producetGroup -n 192.168.1.x:9876</span><br></pre></td></tr></table></figure>







</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ10# RocketMQ查询死信队列中的消息内容</title>
    <url>/posts/cad2b239/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>RocketMQ中当重试消息超过最大重试次数（默认16次），会被发送到%DLQ%开头的死信队列，默认死信队列为只写权限。在有些情况下，想看看死信队列里的内容。</p>
<h1 id="更改死信队列权限"><a href="#更改死信队列权限" class="headerlink" title="更改死信队列权限"></a>更改死信队列权限</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin updateTopicPerm -c ClusterB -t %DLQ%online-tst -p 6 -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">update topic perm from 2 to 6 in 192.168.1.x:10911 success.</span><br><span class="line"></span><br><span class="line">update topic perm from 2 to 6 in 192.168.1.x:10911 success.</span><br><span class="line"></span><br><span class="line">update topic perm from 2 to 6 in 192.168.1.x:10911 success.</span><br><span class="line"></span><br><span class="line">update topic perm from 2 to 6 in 192.168.1.x:10911 success.</span><br><span class="line"></span><br><span class="line">注：将死信队列只写权限更改为读写权限</span><br></pre></td></tr></table></figure>



<h1 id="查询死信队列状态"><a href="#查询死信队列状态" class="headerlink" title="查询死信队列状态"></a>查询死信队列状态</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin topicStatus -n 192.168.1.x:9876 -t %DLQ%online-tst</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Broker Name QID Min Offset Max Offset Last Updated</span><br><span class="line"></span><br><span class="line">broker-a 0 0 109 2018-12-10 18:03:08,732</span><br><span class="line"></span><br><span class="line">broker-a 1 0 109 2018-12-10 18:03:08,740</span><br><span class="line"></span><br><span class="line">broker-a 2 0 110 2018-12-10 18:03:08,750</span><br><span class="line"></span><br><span class="line">broker-a 3 0 109 2018-12-10 18:03:08,728</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="根据offset查询消息内容"><a href="#根据offset查询消息内容" class="headerlink" title="根据offset查询消息内容"></a>根据offset查询消息内容</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin queryMsgByOffset -n localhost:9876 -t %DLQ%online-tst -b broker-a -i 0 -o 108</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">OffsetID: 0A090F2800002A9F000000D70519DD35</span><br><span class="line"></span><br><span class="line">OffsetID: 0A090F2800002A9F000000D70519DD35</span><br><span class="line"></span><br><span class="line">Topic: %DLQ%online-tst</span><br><span class="line"></span><br><span class="line">Tags: [null]</span><br><span class="line"></span><br><span class="line">Keys: [null]</span><br><span class="line"></span><br><span class="line">Queue ID: 0</span><br><span class="line"></span><br><span class="line">Queue Offset: 108</span><br><span class="line"></span><br><span class="line">CommitLog Offset: 923503549749</span><br><span class="line"></span><br><span class="line">Reconsume Times: 0</span><br><span class="line"></span><br><span class="line">Born Timestamp: 2018-12-10 17:59:24,731</span><br><span class="line"></span><br><span class="line">Store Timestamp: 2018-12-10 18:03:08,732</span><br><span class="line"></span><br><span class="line">Born Host: 10.10.128.183:51889</span><br><span class="line"></span><br><span class="line">Store Host: 10.9.15.40:10911</span><br><span class="line"></span><br><span class="line">System Flag: 0</span><br><span class="line"></span><br><span class="line">Properties: &#123;MIN_OFFSET&#x3D;0, MAX_OFFSET&#x3D;109, UNIQ_KEY&#x3D;0A0A80B78DE818B4AAC22FA2493B01B2, WAIT&#x3D;true&#125;</span><br><span class="line"></span><br><span class="line">Message Body Path: &#x2F;tmp&#x2F;rocketmq&#x2F;msgbodys&#x2F;0A0A80B78DE818B4AAC22FA2493B01B2</span><br><span class="line"></span><br><span class="line">注：使用打印命令消息临时存储在&#x2F;tmp&#x2F;rocketmq&#x2F;msgbodys</span><br></pre></td></tr></table></figure>

<h1 id="查看消息内容"><a href="#查看消息内容" class="headerlink" title="查看消息内容"></a>查看消息内容</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;tmp&#x2F;rocketmq&#x2F;msgbodys&#x2F;0A0A80B78DE818B4AAC22FA2490F01AE</span><br><span class="line"></span><br><span class="line">Hello RocketMQ430</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ12# RocketMQ性能优化</title>
    <url>/posts/eb676532/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">一、系统优化</span><br><span class="line"></span><br><span class="line">1.最大文件数</span><br><span class="line"></span><br><span class="line">2.系统参数调整</span><br><span class="line"></span><br><span class="line">二、RocketMQ性能调优</span><br><span class="line"></span><br><span class="line">1.开启异步刷盘</span><br><span class="line"></span><br><span class="line">2.开启堆外内存设置</span><br><span class="line"></span><br><span class="line">3.开启文件预热</span><br><span class="line"></span><br><span class="line">4.开启Slave读权限</span><br><span class="line"></span><br><span class="line">5.关闭堆内存据传输</span><br></pre></td></tr></table></figure>



<h1 id="系统优化"><a href="#系统优化" class="headerlink" title="系统优化"></a>系统优化</h1><h2 id="最大文件数"><a href="#最大文件数" class="headerlink" title="最大文件数"></a>最大文件数</h2><p>limits.conf 设置用户能打开的最大文件数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line"></span><br><span class="line">\# End of file</span><br><span class="line"></span><br><span class="line">baseuser soft nofile 655360</span><br><span class="line"></span><br><span class="line">baseuser hard nofile 655360</span><br><span class="line"></span><br><span class="line">\* soft nofile 655360</span><br><span class="line"></span><br><span class="line">\* hard nofile 655360</span><br></pre></td></tr></table></figure>



<h2 id="系统参数调整"><a href="#系统参数调整" class="headerlink" title="系统参数调整"></a>系统参数调整</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo vim &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"></span><br><span class="line">vm.overcommit_memory&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.drop_caches&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.zone_reclaim_mode&#x3D;0</span><br><span class="line"></span><br><span class="line">vm.max_map_count&#x3D;655360</span><br><span class="line"></span><br><span class="line">vm.dirty_background_ratio&#x3D;50</span><br><span class="line"></span><br><span class="line">vm.dirty_ratio&#x3D;50</span><br><span class="line"></span><br><span class="line">vm.dirty_writeback_centisecs&#x3D;360000</span><br><span class="line"></span><br><span class="line">vm.page-cluster&#x3D;3</span><br><span class="line"></span><br><span class="line">vm.swappiness&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.zone_reclaim_mode&#x3D;1 &#x2F;&#x2F; 主节点</span><br><span class="line"></span><br><span class="line">vm.min_free_kbytes&#x3D;512000</span><br><span class="line"></span><br><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure>



<h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><h3 id="overcommit-memory"><a href="#overcommit-memory" class="headerlink" title="overcommit_memory"></a>overcommit_memory</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">是否允许内存的过量分配</span><br><span class="line"></span><br><span class="line">当为0的时候，当用户申请内存的时候，内核会去检查是否有这么大的内存空间</span><br><span class="line"></span><br><span class="line">当为1的时候，内核始终认为，有足够大的内存空间，直到它用完了为止</span><br><span class="line"></span><br><span class="line">当为2的时候，内核禁止任何形式的过量分配内存</span><br></pre></td></tr></table></figure>

<h3 id="drop-caches"><a href="#drop-caches" class="headerlink" title="drop_caches"></a>drop_caches</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">写入的时候，内核会清空缓存，腾出内存来，相当于sync</span><br><span class="line"></span><br><span class="line">写1的时候，会清空页缓存，就是文件</span><br><span class="line"></span><br><span class="line">写2的时候，会清空inode和目录树</span><br><span class="line"></span><br><span class="line">写3的时候，都清空</span><br><span class="line"></span><br><span class="line">This is a non-destructive operation and will only free things that are completely unused.</span><br><span class="line"></span><br><span class="line">Dirty objects will continue to be in use until written out to disk and are not freeable.</span><br><span class="line"></span><br><span class="line">If you run &quot;sync&quot; first to flush them out to disk, these drop operations will tend to free more memory.</span><br></pre></td></tr></table></figure>

<h3 id="zone-reclaim-mode"><a href="#zone-reclaim-mode" class="headerlink" title="zone_reclaim_mode"></a>zone_reclaim_mode</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">如果为0的话，那么系统会倾向于从其他节点分配内存</span><br><span class="line"></span><br><span class="line">如果为1的话，那么系统会倾向于从本地节点回收Cache内存多数时候</span><br></pre></td></tr></table></figure>

<h3 id="max-map-count"><a href="#max-map-count" class="headerlink" title="max_map_count"></a>max_map_count</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">定义了一个进程能拥有的最多的内存区域，默认为65536</span><br></pre></td></tr></table></figure>



<h3 id="dirty-background-bytes-dirty-background-ratio"><a href="#dirty-background-bytes-dirty-background-ratio" class="headerlink" title="dirty_background_bytes/dirty_background_ratio"></a>dirty_background_bytes/dirty_background_ratio</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">当dirty cache到了多少的时候，就启动pdflush进程，将dirty cache写回磁盘</span><br><span class="line"></span><br><span class="line">当有dirty_background_bytes存在的时候，dirty_background_ratio是被自动计算的</span><br></pre></td></tr></table></figure>



<h3 id="dirty-bytes-dirty-ratio"><a href="#dirty-bytes-dirty-ratio" class="headerlink" title="dirty_bytes/dirty_ratio"></a>dirty_bytes/dirty_ratio</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">当一个进程的dirty cache到了多少的时候，启动pdflush进程，将dirty cache写回磁盘</span><br><span class="line"></span><br><span class="line">当dirty_bytes存在的时候，dirty_ratio是被自动计算的</span><br></pre></td></tr></table></figure>



<h3 id="dirty-writeback-centisecs"><a href="#dirty-writeback-centisecs" class="headerlink" title="dirty_writeback_centisecs"></a>dirty_writeback_centisecs</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pdflush每隔多久，自动运行一次（单位是百分之一秒）</span><br></pre></td></tr></table></figure>



<h3 id="page-cluster"><a href="#page-cluster" class="headerlink" title="page-cluster"></a>page-cluster</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">每次swap in或者swap out操作多少内存页为2的指数。</span><br><span class="line"></span><br><span class="line">等于0的时候，为1页；等于1的时候，为2页；等于2的时候，为4页</span><br></pre></td></tr></table></figure>



<h3 id="swappiness"><a href="#swappiness" class="headerlink" title="swappiness"></a>swappiness</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">swappiness&#x3D;0 仅在内存不足的情况下，当剩余空闲内存低于vm.min_free_kbytes limit时，使用交换空间</span><br><span class="line"></span><br><span class="line">swappiness&#x3D;1 内核版本3.5及以上、Red Hat内核版本2.6.32-303及以上，进行最少量的交换，而不禁用交换</span><br><span class="line"></span><br><span class="line">swappiness&#x3D;10 当系统存在足够内存时，推荐设置为该值以提高性能</span><br><span class="line"></span><br><span class="line">swappiness&#x3D;60 默认值</span><br><span class="line"></span><br><span class="line">swappiness&#x3D;100 内核将积极的使用交换空间</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="RocketMQ性能调优"><a href="#RocketMQ性能调优" class="headerlink" title="RocketMQ性能调优"></a>RocketMQ性能调优</h1><p>线上RocketMQ的JVM未做调优，堆内存使用8G；主要从RocketMQ配置参数方面梳理下。</p>
<h2 id="开启异步刷盘"><a href="#开启异步刷盘" class="headerlink" title="开启异步刷盘"></a>开启异步刷盘</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flushDiskType&#x3D;ASYNC_FLUSH</span><br><span class="line"></span><br><span class="line">同步刷盘TPS过低，较难满足业务发展需求</span><br></pre></td></tr></table></figure>



<h2 id="开启堆外内存设置"><a href="#开启堆外内存设置" class="headerlink" title="开启堆外内存设置"></a>开启堆外内存设置</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">transientStorePoolEnable&#x3D;true</span><br><span class="line"></span><br><span class="line">消息写入到堆外内存，消费时从pageCache消费，读写分离，提升集群性能</span><br></pre></td></tr></table></figure>



<h2 id="开启文件预热"><a href="#开启文件预热" class="headerlink" title="开启文件预热"></a>开启文件预热</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">warmMapedFileEnable&#x3D;true</span><br><span class="line"></span><br><span class="line">开启文件预热，避免日志文件在分配内存时缺页中断</span><br></pre></td></tr></table></figure>



<h2 id="开启Slave读权限"><a href="#开启Slave读权限" class="headerlink" title="开启Slave读权限"></a>开启Slave读权限</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">slaveReadEnable&#x3D;true</span><br><span class="line"></span><br><span class="line">消息占用物理内存的大小通过accessMessageInMemoryMaxRatio来配置默认为40%；</span><br><span class="line"></span><br><span class="line">如果消费的消息不在内存中，开启slaveReadEnable时会从slave节点读取；提高Master内存利用率</span><br></pre></td></tr></table></figure>



<h2 id="关闭堆内存据传输"><a href="#关闭堆内存据传输" class="headerlink" title="关闭堆内存据传输"></a>关闭堆内存据传输</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">transferMsgByHeap默认true设置为false</span><br><span class="line"></span><br><span class="line">Broker响应消费请求时，不必将数据重新读到堆内存再发送给客户端；</span><br><span class="line"></span><br><span class="line">直接从PageCache将数据发送给客户端</span><br></pre></td></tr></table></figure>



<h2 id="延长发送队列等待时间"><a href="#延长发送队列等待时间" class="headerlink" title="延长发送队列等待时间"></a>延长发送队列等待时间</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">waitTimeMillsInSendQueue默认200ms；适当延长到1000ms</span><br><span class="line"></span><br><span class="line">降低由于等待超时客户端快速失败抛出[TIMEOUT_CLEAN_QUEUE]broker busy频率</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ11# RocketMQ集群生产环境节点下线操作</title>
    <url>/posts/6887b617/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="现状描述"><a href="#现状描述" class="headerlink" title="现状描述"></a>现状描述</h1><p>集群其中一台物理机未知原因导致单用户无法登陆机器，该物理机需要重启修改密码或者重装系统。该台为master节点，运行正常。</p>
<p>配置策略为：异步刷盘 &amp; 主从异步复制</p>
<p>如果直接下线该master，由于主从异步复制，可能导致部分消息来不及复制到slave造成消息丢失。所以该方案不可行。</p>
<p>另一种方案选择：关闭该broker的写入权限，待该broker不再有写入和消费时，再下线该节点。</p>
<h1 id="关闭broker写权限"><a href="#关闭broker写权限" class="headerlink" title="关闭broker写权限"></a>关闭broker写权限</h1><p>2表示只写权限，4表示只读权限，6表示读写权限</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin updateBrokerConfig -b 192.168.x.x:10911 -n 192.168.x.x:9876 -k brokerPermission -v 4</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">update broker config success, 192.168.x.x:10911</span><br></pre></td></tr></table></figure>



<h1 id="观察节点流量"><a href="#观察节点流量" class="headerlink" title="观察节点流量"></a>观察节点流量</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin clusterList -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">\#Cluster Name #Broker Name #BID #Addr #Version #InTPS(LOAD) #OutTPS(LOAD) #PCWait(ms) #Hour #SPACE</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-a 0 192.168.x.x:10911 V4_1_0_SNAPSHOT 2492.95(0,0ms) 2269.27(1,0ms) 0 137.57 0.1861</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-a 1 192.168.x.x:10911 V4_1_0_SNAPSHOT 2485.45(0,0ms) 0.00(0,0ms) 0 125.26 0.3055</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-b 0 192.168.x.x:10911 V4_1_0_SNAPSHOT 26.47(0,0ms) 26.08(0,0ms) 0 137.24 0.1610</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-b 1 192.168.x.x:10915 V4_1_0_SNAPSHOT 20.47(0,0ms) 0.00(0,0ms) 0 125.22 0.3055</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-c 0 192.168.x.x:10911 V4_1_0_SNAPSHOT 2061.09(0,0ms) 1967.30(0,0ms) 0 125.28 0.2031</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-c 1 192.168.x.x:10911 V4_1_0_SNAPSHOT 2048.20(0,0ms) 0.00(0,0ms) 0 137.51 0.2789</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-d 0 192.168.x.x:10911 V4_1_0_SNAPSHOT 2017.40(0,0ms) 1788.32(0,0ms) 0 125.22 0.1261</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-d 1 192.168.x.x:10915 V4_1_0_SNAPSHOT 2026.50(0,0ms) 0.00(0,0ms) 0 137.61 0.2789</span><br></pre></td></tr></table></figure>



<p>观察InTPS和OutTPS，理想情况都为零时，并不再变化时，则该节点可下线了。</p>
<p>然而，在实际过程中并没有出现为零的情况，InTPS和OutTPS总是有值，有时个位数字有时是两位数字，大部分时间在20多的值。此刻要分析下broker目前的消费状态。</p>
<a id="more"></a>



<h1 id="观察broker消费状态"><a href="#观察broker消费状态" class="headerlink" title="观察broker消费状态"></a>观察broker消费状态</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqadmin brokerConsumeStats -b 192.168.x.x:10911 -n 192.168.x.x:9876 &gt;&gt; brokerConsumeStats.tmp</span><br></pre></td></tr></table></figure>



<p>查看brokerConsumeStats.tmp，主要查看#LastTime和#Diff。 发现%RETRY%重试类队列#Diff有很微小（1或者3）的数据，而其他topic均为0. LastTime时间最新也是发生在%RETRY%队列中。此时可以让该节点下线操作。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#Topic #Group #Broker Name #QID #Broker Offset #Consumer Offset #Diff #LastTime</span><br><span class="line"></span><br><span class="line">SV_Multi_Message ZTO_SV_EmchatWebConsumerGroup broker-b 0 2171742 2171742 0 2019-04-24 23:38:09</span><br><span class="line"></span><br><span class="line">SV_Multi_Message ZTO_SV_EmchatWebConsumerGroup broker-b 1 2171756 2171756 0 2019-04-24 23:38:50</span><br><span class="line"></span><br><span class="line">SV_Multi_Message ZTO_SV_EmchatWebConsumerGroup broker-b 2 2171740 2171740 0 2019-04-24 23:42:58</span><br><span class="line"></span><br><span class="line">SV_Multi_Message ZTO_SV_EmchatWebConsumerGroup broker-b 3 2171759 2171759 0 2019-04-24 23:40:44</span><br><span class="line"></span><br><span class="line">SV_Multi_Message ZTO_SV_EmchatWebConsumerGroup broker-b 4 2171743 2171743 0 2019-04-24 23:32:48</span><br><span class="line"></span><br><span class="line">SV_Multi_Message ZTO_SV_EmchatWebConsumerGroup broker-b 5 2171740 2171740 0 2019-04-24 23:35:58</span><br><span class="line"></span><br><span class="line">SV_Multi_Message ZTO_SV_EmchatWebConsumerGroup broker-b 6 2171758 2171758 0 2019-04-24 23:36:23</span><br><span class="line"></span><br><span class="line">SV_Multi_Message ZTO_SV_EmchatWebConsumerGroup broker-b 7 2171740 2171740 0 2019-04-24 23:37:50</span><br><span class="line"></span><br><span class="line">%RETRY%ZTO_SV_EmchatWebConsumerG ZTO_SV_EmchatWebConsumerGroup broker-b 0 61876 61876 0 2019-04-24 10:09:04</span><br><span class="line"></span><br><span class="line">%RETRY%SVC_TRACK_CONSUMER SVC_TRACK_CONSUMER broker-b 0 497968 497968 0 2019-04-19 12:51:24</span><br><span class="line"></span><br><span class="line">SVC_TRACK_TOPIC SVC_TRACK_CONSUMER broker-b 0 191710 191710 0 2019-04-24 23:44:22</span><br><span class="line"></span><br><span class="line">SVC_TRACK_TOPIC SVC_TRACK_CONSUMER broker-b 1 191706 191706 0 2019-04-24 23:44:25</span><br><span class="line"></span><br><span class="line">SVC_TRACK_TOPIC SVC_TRACK_CONSUMER broker-b 2 191697 191697 0 2019-04-24 23:44:44</span><br><span class="line"></span><br><span class="line">SVC_TRACK_TOPIC SVC_TRACK_CONSUMER broker-b 3 191695 191695 0 2019-04-24 23:44:47</span><br><span class="line"></span><br><span class="line">SVC_TRACK_TOPIC SVC_TRACK_CONSUMER broker-b 4 191688 191688 0 2019-04-24 23:44:47</span><br><span class="line"></span><br><span class="line">SVC_TRACK_TOPIC SVC_TRACK_CONSUMER broker-b 5 191683 191683 0 2019-04-24 23:44:48</span><br><span class="line"></span><br><span class="line">SVC_TRACK_TOPIC SVC_TRACK_CONSUMER broker-b 6 191676 191676 0 2019-04-24 23:44:49</span><br><span class="line"></span><br><span class="line">SVC_TRACK_TOPIC SVC_TRACK_CONSUMER broker-b 7 191672 191672 0 2019-04-24 23:44:49</span><br></pre></td></tr></table></figure>



<h1 id="borker读写权限恢复"><a href="#borker读写权限恢复" class="headerlink" title="borker读写权限恢复"></a>borker读写权限恢复</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin updateBrokerConfig -b 192.168.x.x:10911 -n 192.168.x.x:9876 -k brokerPermission -v 6</span><br></pre></td></tr></table></figure>



<h1 id="观察各节点流量是否正常"><a href="#观察各节点流量是否正常" class="headerlink" title="观察各节点流量是否正常"></a>观察各节点流量是否正常</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin clusterList -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">\#Cluster Name #Broker Name #BID #Addr #Version #InTPS(LOAD) #OutTPS(LOAD) #PCWait(ms) #Hour #SPACE</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-a 0 192.168.x.x:10911 V4_1_0_SNAPSHOT 2492.95(0,0ms) 2269.27(1,0ms) 0 137.57 0.1861</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-a 1 192.168.x.x:10911 V4_1_0_SNAPSHOT 2485.45(0,0ms) 0.00(0,0ms) 0 125.26 0.3055</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-b 0 192.168.x.x:10911 V4_1_0_SNAPSHOT 2299.47(0,0ms) 2226.08(0,0ms) 0 137.24 0.1610</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-b 1 192.168.x.x:10915 V4_1_0_SNAPSHOT 2280.47(0,0ms) 0.00(0,0ms) 0 125.22 0.3055</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-c 0 192.168.x.x:10911 V4_1_0_SNAPSHOT 2061.09(0,0ms) 1967.30(0,0ms) 0 125.28 0.2031</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-c 1 192.168.x.x:10911 V4_1_0_SNAPSHOT 2048.20(0,0ms) 0.00(0,0ms) 0 137.51 0.2789</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-d 0 192.168.x.x:10911 V4_1_0_SNAPSHOT 2017.40(0,0ms) 1788.32(0,0ms) 0 125.22 0.1261</span><br><span class="line"></span><br><span class="line">ZmsClusterA broker-d 1 192.168.x.x:10915 V4_1_0_SNAPSHOT 2026.50(0,0ms) 0.00(0,0ms) 0 137.61 0.2789</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ14# RocketMQ同步复制性能优化</title>
    <url>/posts/d1c4e530/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>早些时候写过性能测试和性能优化文章，主要基于异步刷盘/异步复制；由于业务需要需要搭建异步刷盘/同步复制集群；同时对性能进行压测。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">压测结果显示集群几乎无法使用，TPS居然是个位数，客户端也在报错。</span><br></pre></td></tr></table></figure>

<h2 id="压测日志"><a href="#压测日志" class="headerlink" title="压测日志"></a>压测日志</h2><p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201218231410.png"></p>
<h2 id="客户端日志"><a href="#客户端日志" class="headerlink" title="客户端日志"></a>客户端日志</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2019-09-19 19:22:38,038 ERROR RocketmqClient - [BENCHMARK_PRODUCER] Send Exception</span><br><span class="line"></span><br><span class="line">org.apache.rocketmq.client.exception.MQBrokerException: CODE: 2 DESC: [TIMEOUT_CLEAN_QUEUE]broker busy, start flow control for a while, period in queue: 209ms, size of queue: 9</span><br><span class="line"></span><br><span class="line">For more information, please visit the url, http:&#x2F;&#x2F;rocketmq.apache.org&#x2F;docs&#x2F;faq&#x2F;</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.client.impl.MQClientAPIImpl.processSendResponse(MQClientAPIImpl.java:671)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessageSync(MQClientAPIImpl.java:467)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.client.impl.MQClientAPIImpl.sendMessage(MQClientAPIImpl.java:449)</span><br><span class="line"></span><br><span class="line">at</span><br></pre></td></tr></table></figure>



<h1 id="解决发送失败情况"><a href="#解决发送失败情况" class="headerlink" title="解决发送失败情况"></a>解决发送失败情况</h1><p>经排查，将transientStorePoolEnable关闭(默认为false)；压测显示最高TPS有1.9万。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">brokerRole&#x3D;SYNC_MASTER</span><br><span class="line"></span><br><span class="line">\#transientStorePoolEnable&#x3D;true</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201218231653.png"></p>
<h1 id="解决发送TPS过低情况"><a href="#解决发送TPS过低情况" class="headerlink" title="解决发送TPS过低情况"></a>解决发送TPS过低情况</h1><p>最高TPS只有1.9万，依然过低，与预期相差甚远，我们预期压测应该可以到7到8万这样可以满足业务发展需要。再次检查broker端参数配置，没有发现有参数导致性能如此过低。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">回顾性能调优的几个方面：系统调优、集群调优、JVM调优。</span><br></pre></td></tr></table></figure>

<p>系统调优与集群调优都已经做过了，唯一没有优化的JVM调优，堆内存设置默认的8G。</p>
<p>JAVA_OPT=”${JAVA_OPT} -server -Xms8g -Xmx8g -Xmn4g”</p>
<p>将JVM堆内存提高4倍后，压测效果明显提升，基本可以达到预期7万多的TPS。</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201218231833.png"></p>
<a id="more"></a>



<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>1.为什么在异步刷盘/同步复制时开启堆外内存池transientStorePoolEnable后，集群压测几乎无法进行？</p>
<p>2.为什么在异步刷盘/同步复制时调大JVM堆内存后，性能明显提升呢？提升了的倍数几乎是堆内存增大的倍数。</p>
<h2 id="刷盘流程回顾"><a href="#刷盘流程回顾" class="headerlink" title="刷盘流程回顾"></a>刷盘流程回顾</h2><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMzY2MDYzMA==&mid=2247483827&idx=1&sn=d7204473069dbad47b0cc7e05ad83acc&chksm=9b9e790aace9f01c84d0e9d686309875064a22704d843cdb941fbebe46728dfb338dc4cfa4bd&scene=21#wechat_redirect">RocketMQ存储–消息追加【源码笔记】</a></p>
<p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMzY2MDYzMA==&mid=2247483855&idx=1&sn=710f8b2eb72ec28ff10eb7dbaf44dc7f&chksm=9b9e7976ace9f0608b5da4d4cf9676580aa599e7ce239b6aba9736cc6c60ff8efafb7910f7b1&scene=21#wechat_redirect">RocketMQ存储–同步刷盘和异步刷盘【源码笔记】</a></p>
<p><strong>异步刷盘未开启堆外缓存示意图</strong></p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201218232152.png"></p>
<p><strong>异步刷盘开启堆外缓存示意图</strong></p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201218232214.png"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">小结：异步刷盘未开启transientStorePoolEnable时，消息追加到mappedByteBuffer中，异步线程刷调用mappedByteBuffer.force落盘；异步刷盘开启transientStorePoolEnable时，消息写入wrtieBuffer中，异步线程将消息提交到fileChannel，然后异步线程调用fileChannel.force落盘。</span><br></pre></td></tr></table></figure>



<h2 id="主从复制回顾"><a href="#主从复制回顾" class="headerlink" title="主从复制回顾"></a>主从复制回顾</h2><p><a href="http://mp.weixin.qq.com/s?__biz=MzAxMzY2MDYzMA==&mid=2247483701&idx=1&sn=9760e50c69285aad2d868a13d810394e&chksm=9b9e798cace9f09aa5d31b5c4b972e627b3fe1afcb892d40fbf57c561b18175bd12119e8c08c&scene=21#wechat_redirect">RocketMQ存储–主从同步【源码笔记】</a></p>
<p>HAConnection#WriteSocketService负责向Slave发送数据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;查找待拉取偏移量之后所有的可读消息</span><br><span class="line"></span><br><span class="line">SelectMappedBufferResult selectResult &#x3D; HAConnection.this.haService.getDefaultMessageStore().getCommitLogData(this.nextTransferFromWhere);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">SelectMappedBufferResult result &#x3D; mappedFile.selectMappedBuffer(pos);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">ByteBuffer byteBuffer &#x3D; this.mappedByteBuffer.slice();</span><br><span class="line"></span><br><span class="line">byteBuffer.position(pos);</span><br><span class="line"></span><br><span class="line">int size &#x3D; readPosition - pos; &#x2F;&#x2F;计算距离最大可读位置的大小</span><br><span class="line"></span><br><span class="line">ByteBuffer byteBufferNew &#x3D; byteBuffer.slice();</span><br><span class="line"></span><br><span class="line">byteBufferNew.limit(size);</span><br><span class="line"></span><br><span class="line">return new SelectMappedBufferResult()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">小结：主从复制使用mappedByteBuffer向Slave同步数据。</span><br></pre></td></tr></table></figure>

<h2 id="流程模拟"><a href="#流程模拟" class="headerlink" title="流程模拟"></a>流程模拟</h2><h3 id="开启堆外内存池流程"><a href="#开启堆外内存池流程" class="headerlink" title="开启堆外内存池流程"></a>开启堆外内存池流程</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line"></span><br><span class="line">public void test01()&#123;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 堆外内存池transientStorePoolEnable开启后，消息追加操作</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line"></span><br><span class="line">File file &#x3D; new File(&quot;&#x2F;Users&#x2F;yongliang&#x2F;logs&#x2F;temp.log&quot;);</span><br><span class="line"></span><br><span class="line">FileChannel fileChannel &#x3D; new RandomAccessFile(file, &quot;rw&quot;).getChannel();</span><br><span class="line"></span><br><span class="line">String data &#x3D; &quot;beautiful girl!&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; mmap 文件映射操作</span><br><span class="line"></span><br><span class="line">MappedByteBuffer mappedByteBuffer &#x3D; fileChannel.map(FileChannel.MapMode.READ_WRITE, 0, data.length());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 堆外内存transientStorePoolEnable开启</span><br><span class="line"></span><br><span class="line">ByteBuffer byteBuffer &#x3D; ByteBuffer.allocateDirect(data.length());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ----------------消息追加开始-----------------------</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 注意此时使用堆内内存分配</span><br><span class="line"></span><br><span class="line">ByteBuffer msgStoreItemMemory &#x3D; ByteBuffer.allocate(data.length());</span><br><span class="line"></span><br><span class="line">msgStoreItemMemory.put(data.getBytes());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 开启transientStorePoolEnable消息写入了ByteBuffer</span><br><span class="line"></span><br><span class="line">byteBuffer.put(msgStoreItemMemory.array(),0,data.length());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ----------------消息追加结束-----------------------</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ----------------消息提交开始-----------------------</span><br><span class="line"></span><br><span class="line">byteBuffer.position(0);</span><br><span class="line"></span><br><span class="line">byteBuffer.limit(data.length());</span><br><span class="line"></span><br><span class="line">fileChannel.write(byteBuffer);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ----------------消息提交结束-----------------------</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; --------主从复制从mappedByteBuffer获取消息开始----------</span><br><span class="line"></span><br><span class="line">mappedByteBuffer.position(0);</span><br><span class="line"></span><br><span class="line">mappedByteBuffer.limit(data.length());</span><br><span class="line"></span><br><span class="line">Charset charset &#x3D; Charset.forName(&quot;UTF-8&quot;);</span><br><span class="line"></span><br><span class="line">CharsetDecoder decoder &#x3D; charset.newDecoder();</span><br><span class="line"></span><br><span class="line">CharBuffer charBuffer &#x3D; decoder.decode(mappedByteBuffer.asReadOnlyBuffer());</span><br><span class="line"></span><br><span class="line">System.out.println(charBuffer.toString());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; --------主从复制从mappedByteBuffer获取消息结束----------</span><br><span class="line"></span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">e.printStackTrace();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">小结：模拟开启堆外内存池transientStorePoolEnable的消息追加及主从复制流程。</span><br></pre></td></tr></table></figure>

<h3 id="未开启堆外内存池流程"><a href="#未开启堆外内存池流程" class="headerlink" title="未开启堆外内存池流程"></a>未开启堆外内存池流程</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line"></span><br><span class="line">public void test02()&#123;</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line"></span><br><span class="line">File file &#x3D; new File(&quot;&#x2F;Users&#x2F;yongliang&#x2F;logs&#x2F;temp1.log&quot;);</span><br><span class="line"></span><br><span class="line">FileChannel fileChannel &#x3D; new RandomAccessFile(file, &quot;rw&quot;).getChannel();</span><br><span class="line"></span><br><span class="line">String data &#x3D; &quot;beautiful girl!&quot;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; mmap 文件映射操作</span><br><span class="line"></span><br><span class="line">MappedByteBuffer mappedByteBuffer &#x3D; fileChannel.map(FileChannel.MapMode.READ_WRITE, 0, data.length());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ----------------消息追加开始-----------------------</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 注意消息组装使用堆内内存分配</span><br><span class="line"></span><br><span class="line">ByteBuffer msgStoreItemMemory &#x3D; ByteBuffer.allocate(data.length());</span><br><span class="line"></span><br><span class="line">msgStoreItemMemory.put(data.getBytes());</span><br><span class="line"></span><br><span class="line">mappedByteBuffer.put(msgStoreItemMemory.array(),0,data.length());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ----------------消息追加结束-----------------------</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; --------主从复制从mappedByteBuffer获取消息开始----------</span><br><span class="line"></span><br><span class="line">mappedByteBuffer.position(0);</span><br><span class="line"></span><br><span class="line">mappedByteBuffer.limit(data.length());</span><br><span class="line"></span><br><span class="line">Charset charset &#x3D; Charset.forName(&quot;UTF-8&quot;);</span><br><span class="line"></span><br><span class="line">CharsetDecoder decoder &#x3D; charset.newDecoder();</span><br><span class="line"></span><br><span class="line">CharBuffer charBuffer &#x3D; decoder.decode(mappedByteBuffer.asReadOnlyBuffer());</span><br><span class="line"></span><br><span class="line">System.out.println(charBuffer.toString());</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; --------主从复制从mappedByteBuffer获取消息结束----------</span><br><span class="line"></span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">e.printStackTrace();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">小结：模拟未开启堆外内存池transientStorePoolEnable的消息追加及主从复制流程。</span><br></pre></td></tr></table></figure>

<h1 id="原因总结"><a href="#原因总结" class="headerlink" title="原因总结"></a>原因总结</h1><p>1.为什么在异步刷盘/同步复制时开启堆外内存transientStorePoolEnable后，集群压测几乎无法进行？</p>
<p>解释：</p>
<p>1&gt;主从同步复制使用mappedByteBuffer；</p>
<p>2&gt;开启堆外内存池transientStorePoolEnable后数据先落到WriteBuffer，再通过异步提交线程提交到FileChannel，再通过mmap将数据映射到mappedByteBuffer；</p>
<p>3&gt;未开启堆外内存池transientStorePoolEnable数据直接写入到mappedByteBuffe；</p>
<p>由于开启堆外内存数据映射到mappedByteBuffer比直接写入mappedByteBuffer多了很多步骤，再加上发送队列处理事件默认只有200毫秒（waitTimeMillsInSendQueue=200），造成集群不能正常压测的原因。</p>
<p>2.为什么在异步刷盘/同步复制时调大JVM堆内存后，性能明显提升呢？提升了的倍数几乎是对内存增大的倍数。</p>
<p>解释：</p>
<p>从模拟流程中可以看出，在组装消息时使用堆内存，提高堆内存显著提高写入Tps的原因所在。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; 注意消息组装使用堆内内存分配</span><br><span class="line"></span><br><span class="line">ByteBuffer msgStoreItemMemory &#x3D; ByteBuffer.allocate(data.length());</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ15# RocketMQ生产环境配置</title>
    <url>/posts/50d4ff7d/</url>
    <content><![CDATA[<div id="vip-container"><p>一份RocketMQ生产环境的配置文件，供参考，集群架构为异步刷盘异步复制。另外有补充的欢迎后台留言给我。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#请修改</span><br><span class="line"></span><br><span class="line">brokerClusterName&#x3D;XXXCluster</span><br><span class="line"></span><br><span class="line">brokerName&#x3D;broker-a</span><br><span class="line"></span><br><span class="line">brokerId&#x3D;0</span><br><span class="line"></span><br><span class="line">listenPort&#x3D;10911</span><br><span class="line"></span><br><span class="line">#请修改</span><br><span class="line"></span><br><span class="line">namesrvAddr&#x3D;x.x.x.x:9876;x.x.x.x::9876</span><br><span class="line"></span><br><span class="line">defaultTopicQueueNums&#x3D;4</span><br><span class="line"></span><br><span class="line">autoCreateTopicEnable&#x3D;false</span><br><span class="line"></span><br><span class="line">autoCreateSubscriptionGroup&#x3D;false</span><br><span class="line"></span><br><span class="line">deleteWhen&#x3D;04</span><br><span class="line"></span><br><span class="line">fileReservedTime&#x3D;48</span><br><span class="line"></span><br><span class="line">mapedFileSizeCommitLog&#x3D;1073741824</span><br><span class="line"></span><br><span class="line">mapedFileSizeConsumeQueue&#x3D;50000000</span><br><span class="line"></span><br><span class="line">destroyMapedFileIntervalForcibly&#x3D;120000</span><br><span class="line"></span><br><span class="line">redeleteHangedFileInterval&#x3D;120000</span><br><span class="line"></span><br><span class="line">diskMaxUsedSpaceRatio&#x3D;88</span><br><span class="line"></span><br><span class="line">#存储路径</span><br><span class="line"></span><br><span class="line">storePathRootDir&#x3D;&#x2F;data&#x2F;rocketmq&#x2F;store</span><br><span class="line"></span><br><span class="line">#commitLog存储路径</span><br><span class="line"></span><br><span class="line">storePathCommitLog&#x3D;&#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;commitlog</span><br><span class="line"></span><br><span class="line">#消费队列存储路径</span><br><span class="line"></span><br><span class="line">storePathConsumeQueue&#x3D;&#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;consumequeue</span><br><span class="line"></span><br><span class="line"># 消息索引存储路径</span><br><span class="line"></span><br><span class="line">storePathIndex&#x3D;&#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;index</span><br><span class="line"></span><br><span class="line"># checkpoint 文件存储路径</span><br><span class="line"></span><br><span class="line">storeCheckpoint&#x3D;&#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;checkpoint</span><br><span class="line"></span><br><span class="line">#abort 文件存储路径</span><br><span class="line"></span><br><span class="line">abortFile&#x3D;&#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;abort</span><br><span class="line"></span><br><span class="line">maxMessageSize&#x3D;65536</span><br><span class="line"></span><br><span class="line">flushCommitLogLeastPages&#x3D;4</span><br><span class="line"></span><br><span class="line">flushConsumeQueueLeastPages&#x3D;2</span><br><span class="line"></span><br><span class="line">flushCommitLogThoroughInterval&#x3D;10000</span><br><span class="line"></span><br><span class="line">flushConsumeQueueThoroughInterval&#x3D;60000</span><br><span class="line"></span><br><span class="line">brokerRole&#x3D;SYNC_MASTER</span><br><span class="line"></span><br><span class="line">flushDiskType&#x3D;ASYNC_FLUSH</span><br><span class="line"></span><br><span class="line">checkTransactionMessageEnable&#x3D;false</span><br><span class="line"></span><br><span class="line">maxTransferCountOnMessageInMemory&#x3D;1000</span><br><span class="line"></span><br><span class="line">transientStorePoolEnable&#x3D;true</span><br><span class="line"></span><br><span class="line">warmMapedFileEnable&#x3D;true</span><br><span class="line"></span><br><span class="line">pullMessageThreadPoolNums&#x3D;128</span><br><span class="line"></span><br><span class="line">slaveReadEnable&#x3D;true</span><br><span class="line"></span><br><span class="line">transferMsgByHeap&#x3D;false</span><br><span class="line"></span><br><span class="line">waitTimeMillsInSendQueue&#x3D;1000</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ16# RocketMQ一次延迟消息故障排查</title>
    <url>/posts/258cdfc5/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>RocketMQ社区版本支持18个延迟级别，每个级别在设定的时间都被会消费者准确消费到。为此也专门测试过消费的间隔是不是准确，测试结果显示很准确。</p>
<p>然而，如此准确的特性居然出问题了，接到业务同学报告线上某个集群延迟消息消费不到，开发环境、测试环境都没问题。各个环境的版本都是统一的RocketMQ 4.5.2。诡异！</p>
<h1 id="临时方案"><a href="#临时方案" class="headerlink" title="临时方案"></a>临时方案</h1><p>将该业务的topic和consumer转移到线上其他集群，延迟消息消费正常。</p>
<h1 id="问题定位"><a href="#问题定位" class="headerlink" title="问题定位"></a>问题定位</h1><h2 id="搜查日志"><a href="#搜查日志" class="headerlink" title="搜查日志"></a>搜查日志</h2><p>发现storeerror.log一直刷下面的日志，观察发现offset远远超过了存储的大小！</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020-03-18 16:38:06 WARN ScheduleMessageTimerThread - Offset not matched. Request offset: 509548460, firstOffset: 0, lastOffset: 6000000, mappedFileSize: 6000000, mappedFiles count: 1</span><br><span class="line"></span><br><span class="line">2020-03-18 16:38:06 WARN ScheduleMessageTimerThread - Offset not matched. Request offset: 665682360, firstOffset: 0, lastOffset: 6000000, mappedFileSize: 6000000, mappedFiles count: 1</span><br><span class="line"></span><br><span class="line">2020-03-18 16:38:07 WARN ScheduleMessageTimerThread - Offset not matched. Request offset: 509548460, firstOffset: 0, lastOffset: 6000000, mappedFileSize: 6000000, mappedFiles count: 1</span><br><span class="line"></span><br><span class="line">2020-03-18 16:38:07 WARN ScheduleMessageTimerThread - Offset not matched. Request offset: 665682360, firstOffset: 0, lastOffset: 6000000, mappedFileSize: 6000000, mappedFiles count: 1</span><br><span class="line"></span><br><span class="line">2020-03-18 16:38:07 WARN ScheduleMessageTimerThread - Offset not matched. Request offset: 509548460, firstOffset: 0, lastOffset: 6000000, mappedFileSize: 6000000, mappedFiles count: 1</span><br><span class="line"></span><br><span class="line">2020-03-18 16:38:07 WARN ScheduleMessageTimerThread - Offset not matched. Request offset: 665682360, firstOffset: 0, lastOffset: 6000000, mappedFileSize: 6000000, mappedFiles count: 1</span><br><span class="line"></span><br><span class="line">2020-03-18 16:38:07 WARN ScheduleMessageTimerThread - Offset not matched. Request offset: 509548460, firstOffset: 0, lastOffset: 6000000, mappedFileSize: 6000000, mappedFiles count: 1</span><br></pre></td></tr></table></figure>



<h2 id="消息查询"><a href="#消息查询" class="headerlink" title="消息查询"></a>消息查询</h2><p>通过查询发送延迟的消息，发现该消息存储成功；已经存储在了“SCHEDULE_TOPIC_XXXX”中了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin queryMsgById -n x.x.x.x:9876 -i 0A6F160300002A9F000000BACA44720C</span><br><span class="line"></span><br><span class="line">RocketMQLog:WARN No appenders could be found for logger (io.netty.util.internal.PlatformDependent0).</span><br><span class="line"></span><br><span class="line">RocketMQLog:WARN Please initialize the logger system properly.</span><br><span class="line"></span><br><span class="line">OffsetID: 0A6F160300002A9F000000BACA44720C</span><br><span class="line"></span><br><span class="line">OffsetID: 0A6F160300002A9F000000BACA44720C</span><br><span class="line"></span><br><span class="line">Topic: SCHEDULE_TOPIC_XXXX</span><br><span class="line"></span><br><span class="line">Tags: [null]</span><br><span class="line"></span><br><span class="line">Keys: [rocketmq.key.-1351724170]</span><br><span class="line"></span><br><span class="line">Queue ID: 3</span><br><span class="line"></span><br><span class="line">Queue Offset: 142</span><br><span class="line"></span><br><span class="line">CommitLog Offset: 802257400332</span><br><span class="line"></span><br><span class="line">Reconsume Times: 0</span><br><span class="line"></span><br><span class="line">Born Timestamp: 2020-03-18 15:27:37,512</span><br><span class="line"></span><br><span class="line">Store Timestamp: 2020-03-18 15:27:37,513</span><br><span class="line"></span><br><span class="line">Born Host: 10.x.x.x:56650</span><br><span class="line"></span><br><span class="line">Store Host: 10.x.x.x:10911</span><br><span class="line"></span><br><span class="line">System Flag: 0</span><br><span class="line"></span><br><span class="line">Properties: &#123;REAL_TOPIC&#x3D;melon_online_test, KEYS&#x3D;rocketmq.key.-1351724170, UNIQ_KEY&#x3D;0A6F15AB6305070DEA4E5ADD60280023, WAIT&#x3D;true, DELAY&#x3D;4, REAL_QID&#x3D;1&#125;</span><br><span class="line"></span><br><span class="line">Message Body Path: &#x2F;tmp&#x2F;rocketmq&#x2F;msgbodys&#x2F;0A6F15AB6305070DEA4E5ADD60280023</span><br><span class="line"></span><br><span class="line">org.apache.rocketmq.client.exception.MQClientException: CODE: 17 DESC: No topic route info in name server for the topic: SCHEDULE_TOPIC_XXXX</span><br><span class="line"></span><br><span class="line">See http:&#x2F;&#x2F;rocketmq.apache.org&#x2F;docs&#x2F;faq&#x2F; for further details.</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.client.impl.MQClientAPIImpl.getTopicRouteInfoFromNameServer(MQClientAPIImpl.java:1351)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.client.impl.MQClientAPIImpl.getTopicRouteInfoFromNameServer(MQClientAPIImpl.java:1321)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.admin.DefaultMQAdminExtImpl.examineTopicRouteInfo(DefaultMQAdminExtImpl.java:305)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.admin.DefaultMQAdminExtImpl.queryTopicConsumeByWho(DefaultMQAdminExtImpl.java:619)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.admin.DefaultMQAdminExtImpl.messageTrackDetail(DefaultMQAdminExtImpl.java:776)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.admin.DefaultMQAdminExt.messageTrackDetail(DefaultMQAdminExt.java:435)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.command.message.QueryMsgByIdSubCommand.printMsg(QueryMsgByIdSubCommand.java:145)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.command.message.QueryMsgByIdSubCommand.queryById(QueryMsgByIdSubCommand.java:49)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.command.message.QueryMsgByIdSubCommand.execute(QueryMsgByIdSubCommand.java:252)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.command.MQAdminStartup.main0(MQAdminStartup.java:138)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.tools.command.MQAdminStartup.main(MQAdminStartup.java:89)</span><br></pre></td></tr></table></figure>



<h2 id="原理回顾"><a href="#原理回顾" class="headerlink" title="原理回顾"></a>原理回顾</h2><p>延迟消息存储时被替换为“SCHEDULE_TOPIC_XXXX”主题，broker会为每个等级的建立定时任务进行调度，将各个等级到时间的消息替换为原来的主题，从而消费者可以消费到该消息。</p>
<p>以上日志加上消息查询结果已存储在“SCHEDULE_TOPIC_XXXX”，可以断定调度环节出问题了，由于offset远远超过最大offset而报错；没能将目标主题成功替换。</p>
<h2 id="报错源码"><a href="#报错源码" class="headerlink" title="报错源码"></a>报错源码</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public MappedFile findMappedFileByOffset(final long offset, final boolean returnFirstOnNotFound) &#123;</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line"></span><br><span class="line">MappedFile firstMappedFile &#x3D; this.getFirstMappedFile();</span><br><span class="line"></span><br><span class="line">MappedFile lastMappedFile &#x3D; this.getLastMappedFile();</span><br><span class="line"></span><br><span class="line">if (firstMappedFile !&#x3D; null &amp;&amp; lastMappedFile !&#x3D; null) &#123;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 这里报错了，每次用offset&#x3D;509548460来查，可是总大小才6000000</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 每次来查报错返回null</span><br><span class="line"></span><br><span class="line">if (offset &lt; firstMappedFile.getFileFromOffset() || offset &gt;&#x3D; lastMappedFile.getFileFromOffset() + this.mappedFileSize) &#123;</span><br><span class="line"></span><br><span class="line">LOG_ERROR.warn(&quot;Offset not matched. Request offset: &#123;&#125;, firstOffset: &#123;&#125;, lastOffset: &#123;&#125;, mappedFileSize: &#123;&#125;, mappedFiles count: &#123;&#125;&quot;,</span><br><span class="line"></span><br><span class="line">offset,</span><br><span class="line"></span><br><span class="line">firstMappedFile.getFileFromOffset(),</span><br><span class="line"></span><br><span class="line">lastMappedFile.getFileFromOffset() + this.mappedFileSize,</span><br><span class="line"></span><br><span class="line">this.mappedFileSize,</span><br><span class="line"></span><br><span class="line">this.mappedFiles.size());</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">log.error(&quot;findMappedFileByOffset Exception&quot;, e);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return null;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>调用位置：ScheduleMessageService#executeOnTimeup</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; 根据offset捞取消息内容</span><br><span class="line"></span><br><span class="line">MessageExt msgExt &#x3D; ScheduleMessageService.this.defaultMessageStore.lookMessageByOffset(</span><br><span class="line">offsetPy, sizePy);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 处理结束后处理位点自增</span><br><span class="line"></span><br><span class="line">nextOffset &#x3D; offset + (i &#x2F; ConsumeQueue.CQ_STORE_UNIT_SIZE);</span><br><span class="line">ScheduleMessageService.this.updateOffset(this.delayLevel, nextOffset);</span><br></pre></td></tr></table></figure>



<p>其中offsetPy来自ConsumeQueue；另外delayOffset.json存储延迟消息的处理进度。</p>
<h1 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h1><p>将”delayOffset.json”和”consumequeue/SCHEDULE_TOPIC_XXXX”移到其他目录，相当于删除；逐台重启broker节点。重启结束后，经过验证，延迟消息功能正常发送和消费。</p>
<h1 id="结束了吗？"><a href="#结束了吗？" class="headerlink" title="结束了吗？"></a>结束了吗？</h1><p>看到这里你可能还有疑问，offset如何能增长到665682360这么大的？而且offset完全由broker自身去调度后自增的，并非由客户端上报的。记得前年RocketMQ也出现过类似问题，那时候RocketMQ版本是4.1，在测试环境延迟消息失效。此问题很罕见，一年未必碰到一会，后面会提交给社区讨论下。</p>
</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ17# RocketMQ/Kafka监控项整理</title>
    <url>/posts/7cbb1243/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="系统监控项"><a href="#系统监控项" class="headerlink" title="系统监控项"></a>系统监控项</h1><h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><p>CPU使用率、CPU Load、</p>
<h2 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h2><p>内存使用率</p>
<h2 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h2><p>磁盘使用率、磁盘IO、磁盘IOWAIT</p>
<h2 id="带宽"><a href="#带宽" class="headerlink" title="带宽"></a>带宽</h2><p>带宽检测</p>
<h2 id="实例存活"><a href="#实例存活" class="headerlink" title="实例存活"></a>实例存活</h2><p>集群实例是否存活、实例端口是否可达</p>
<h2 id="JVM监控"><a href="#JVM监控" class="headerlink" title="JVM监控"></a>JVM监控</h2><p>堆内存、Full GC时间等</p>
<h1 id="集群监控项"><a href="#集群监控项" class="headerlink" title="集群监控项"></a>集群监控项</h1><h2 id="集群节点数量"><a href="#集群节点数量" class="headerlink" title="集群节点数量"></a>集群节点数量</h2><p>注：比如RocketMQ集群中有4主4从；当Master节点数量小于4时</p>
<h2 id="集群节点可用性"><a href="#集群节点可用性" class="headerlink" title="集群节点可用性"></a>集群节点可用性</h2><p>注：检测集群节点是否可达以及RT Time</p>
<h2 id="集群写入TPS"><a href="#集群写入TPS" class="headerlink" title="集群写入TPS"></a>集群写入TPS</h2><p>注：例如集群写入TPS压测值的40%</p>
<h2 id="集群消费TPS"><a href="#集群消费TPS" class="headerlink" title="集群消费TPS"></a>集群消费TPS</h2><p>注：集群消费TPS需关注带宽及CPU</p>
<h2 id="集群写入TPS变化率"><a href="#集群写入TPS变化率" class="headerlink" title="集群写入TPS变化率"></a>集群写入TPS变化率</h2><p>注：例如5分钟内集群TPS陡增30%</p>
<h2 id="集群消费TPS变化率"><a href="#集群消费TPS变化率" class="headerlink" title="集群消费TPS变化率"></a>集群消费TPS变化率</h2><p>注：例如5分钟内集群TPS陡增30%</p>
<h2 id="集群日消息总量的变化"><a href="#集群日消息总量的变化" class="headerlink" title="集群日消息总量的变化"></a>集群日消息总量的变化</h2><p>注：例如集群中每日的消息总量监控</p>
<h2 id="Broker写入-消费TPS"><a href="#Broker写入-消费TPS" class="headerlink" title="Broker写入/消费TPS"></a>Broker写入/消费TPS</h2><p>注：单节点的写入/消费TPS</p>
<a id="more"></a>



<h1 id="主题监控项"><a href="#主题监控项" class="headerlink" title="主题监控项"></a>主题监控项</h1><h2 id="主题写入TPS"><a href="#主题写入TPS" class="headerlink" title="主题写入TPS"></a>主题写入TPS</h2><p>注：单一主题的写入速率</p>
<h2 id="主题写入TPS的变化率"><a href="#主题写入TPS的变化率" class="headerlink" title="主题写入TPS的变化率"></a>主题写入TPS的变化率</h2><p>注：例如某一主题5分钟内速率陡增30%</p>
<h2 id="主题日消息量"><a href="#主题日消息量" class="headerlink" title="主题日消息量"></a>主题日消息量</h2><p>注：例如单一主题每日消息量</p>
<h2 id="死信队列监控"><a href="#死信队列监控" class="headerlink" title="死信队列监控"></a>死信队列监控</h2><p>注：被丢入死信队列的消息监控</p>
<h1 id="消费组监控项"><a href="#消费组监控项" class="headerlink" title="消费组监控项"></a>消费组监控项</h1><h2 id="消费积压"><a href="#消费积压" class="headerlink" title="消费积压"></a>消费积压</h2><p>注：积压量的监控</p>
<h2 id="消费TPS"><a href="#消费TPS" class="headerlink" title="消费TPS"></a>消费TPS</h2><p>注：消费速率监控</p>
<h2 id="消费阻塞"><a href="#消费阻塞" class="headerlink" title="消费阻塞"></a>消费阻塞</h2><p>注：消费者隔特定时间未消费数据</p>
<h2 id="消费速率变化"><a href="#消费速率变化" class="headerlink" title="消费速率变化"></a>消费速率变化</h2><p>注：例如5分钟之内消费速率陡降了30%</p>
<h1 id="发送客户端监控项"><a href="#发送客户端监控项" class="headerlink" title="发送客户端监控项"></a>发送客户端监控项</h1><h2 id="发送消息体大小变化"><a href="#发送消息体大小变化" class="headerlink" title="发送消息体大小变化"></a>发送消息体大小变化</h2><p>注：发送消息的大小在小于1K、1～2K、大于5K等的分布</p>
<h2 id="发送耗时变化"><a href="#发送耗时变化" class="headerlink" title="发送耗时变化"></a>发送耗时变化</h2><p>注：单节点消息发送在不通时间范围内的分布</p>
<h2 id="发送速率变化"><a href="#发送速率变化" class="headerlink" title="发送速率变化"></a>发送速率变化</h2><p>注：单个发送节点速率变化</p>
<h2 id="发送成功失败分布"><a href="#发送成功失败分布" class="headerlink" title="发送成功失败分布"></a>发送成功失败分布</h2><p>注：消息发送成功/失败分布情况</p>
<h1 id="消费客户端监控项"><a href="#消费客户端监控项" class="headerlink" title="消费客户端监控项"></a>消费客户端监控项</h1><h2 id="消费速率变化-1"><a href="#消费速率变化-1" class="headerlink" title="消费速率变化"></a>消费速率变化</h2><p>注：单节点速率变化</p>
<h2 id="消费耗时变化"><a href="#消费耗时变化" class="headerlink" title="消费耗时变化"></a>消费耗时变化</h2><p>注：单节点发送耗时分布情况</p>
<h2 id="消费成功失败分布"><a href="#消费成功失败分布" class="headerlink" title="消费成功失败分布"></a>消费成功失败分布</h2><p>注：单节点消费成功失败的分布情况</p>
</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ18# RocketMQ关于Broker闪断故障排查</title>
    <url>/posts/89ef1054/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>在2020-03-16 18:00左右收到告警，业务出现发送RocketMQ失败，在约1分钟左右后自动恢复。RocketMQ运行向来稳定，为何也抖动了？</p>
<h1 id="Broker日志分析"><a href="#Broker日志分析" class="headerlink" title="Broker日志分析"></a>Broker日志分析</h1><h2 id="查看GC日志"><a href="#查看GC日志" class="headerlink" title="查看GC日志"></a>查看GC日志</h2><p>通过查看发时间问题时间附近GC日志并无发现异常。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020-03-16T17:49:13.785+0800: 13484510.599: Total time for which application threads were stopped: 0.0072354 seconds, Stopping threads took: 0.0001536 seconds</span><br><span class="line"></span><br><span class="line">2020-03-16T18:01:23.149+0800: 13485239.963: [GC pause (G1 Evacuation Pause) (young) 13485239.965: [G1Ergonomics (CSet Construction) start choosing CSet, _pending_cards: 7738, predicted base time: 5.74 ms, remaining time: 194.26 ms, target pause time: 200.00 ms]</span><br><span class="line"></span><br><span class="line">13485239.965: [G1Ergonomics (CSet Construction) add young regions to CSet, eden: 255 regions, survivors: 1 regions, predicted young region time: 0.52 ms]</span><br><span class="line"></span><br><span class="line">13485239.965: [G1Ergonomics (CSet Construction) finish choosing CSet, eden: 255 regions, survivors: 1 regions, old: 0 regions, predicted pause time: 6.26 ms, target pause time: 200.00 ms]</span><br><span class="line"></span><br><span class="line">, 0.0090963 secs]</span><br><span class="line"></span><br><span class="line">[Parallel Time: 2.3 ms, GC Workers: 23]</span><br><span class="line"></span><br><span class="line">[GC Worker Start (ms): Min: 13485239965.1, Avg: 13485239965.4, Max: 13485239965.7, Diff: 0.6]</span><br><span class="line"></span><br><span class="line">[Ext Root Scanning (ms): Min: 0.0, Avg: 0.3, Max: 0.6, Diff: 0.6, Sum: 8.0]</span><br><span class="line"></span><br><span class="line">[Update RS (ms): Min: 0.1, Avg: 0.3, Max: 0.6, Diff: 0.5, Sum: 7.8]</span><br><span class="line"></span><br><span class="line">[Processed Buffers: Min: 2, Avg: 5.7, Max: 11, Diff: 9, Sum: 131]</span><br><span class="line"></span><br><span class="line">[Scan RS (ms): Min: 0.0, Avg: 0.0, Max: 0.1, Diff: 0.1, Sum: 0.8]</span><br><span class="line"></span><br><span class="line">[Code Root Scanning (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.3]</span><br><span class="line"></span><br><span class="line">[Object Copy (ms): Min: 0.2, Avg: 0.5, Max: 0.7, Diff: 0.4, Sum: 11.7]</span><br><span class="line"></span><br><span class="line">[Termination (ms): Min: 0.0, Avg: 0.0, Max: 0.0, Diff: 0.0, Sum: 0.3]</span><br><span class="line"></span><br><span class="line">[Termination Attempts: Min: 1, Avg: 1.0, Max: 1, Diff: 0, Sum: 23]</span><br><span class="line"></span><br><span class="line">[GC Worker Other (ms): Min: 0.0, Avg: 0.2, Max: 0.3, Diff: 0.3, Sum: 3.6]</span><br><span class="line"></span><br><span class="line">[GC Worker Total (ms): Min: 1.0, Avg: 1.4, Max: 1.9, Diff: 0.8, Sum: 32.6]</span><br><span class="line"></span><br><span class="line">[GC Worker End (ms): Min: 13485239966.7, Avg: 13485239966.9, Max: 13485239967.0, Diff: 0.3]</span><br><span class="line"></span><br><span class="line">[Code Root Fixup: 0.0 ms]</span><br><span class="line"></span><br><span class="line">[Code Root Purge: 0.0 ms]</span><br><span class="line"></span><br><span class="line">[Clear CT: 0.9 ms]</span><br><span class="line"></span><br><span class="line">[Other: 5.9 ms]</span><br><span class="line"></span><br><span class="line">[Choose CSet: 0.0 ms]</span><br><span class="line"></span><br><span class="line">[Ref Proc: 1.9 ms]</span><br><span class="line"></span><br><span class="line">[Ref Enq: 0.0 ms]</span><br><span class="line"></span><br><span class="line">[Redirty Cards: 1.0 ms]</span><br><span class="line"></span><br><span class="line">[Humongous Register: 0.0 ms]</span><br><span class="line"></span><br><span class="line">[Humongous Reclaim: 0.0 ms]</span><br><span class="line"></span><br><span class="line">[Free CSet: 0.2 ms]</span><br><span class="line"></span><br><span class="line">[Eden: 4080.0M(4080.0M)-&gt;0.0B(4080.0M) Survivors: 16.0M-&gt;16.0M Heap: 4176.5M(8192.0M)-&gt;96.5M(8192.0M)]</span><br><span class="line"></span><br><span class="line">[Times: user&#x3D;0.05 sys&#x3D;0.00, real&#x3D;0.01 secs]</span><br></pre></td></tr></table></figure>



<h2 id="查看Broker日志"><a href="#查看Broker日志" class="headerlink" title="查看Broker日志"></a>查看Broker日志</h2><p>由日志可以看出：slave与问题节点broker同步信息异常。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020-03-16 17:55:15 ERROR BrokerControllerScheduledThread1 - SyncTopicConfig Exception, x.x.x.x:10911</span><br><span class="line"></span><br><span class="line">org.apache.rocketmq.remoting.exception.RemotingTimeoutException: wait response on the channel &lt;x.x.x.x:10909&gt; timeout, 3000(ms)</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.remoting.netty.NettyRemotingAbstract.invokeSyncImpl(NettyRemotingAbstract.java:427) ~[rocketmq-remoting-4.5.2.jar:4.5.2]</span><br><span class="line"></span><br><span class="line">at org.apache.rocketmq.remoting.netty.NettyRemotingClient.invokeSync(NettyRemotingClient.java:375) ~[rocketmq-remoting-4.5.2.jar:4.5.2]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：通过查看RocketMQ的集群和GC日志，只能说明但是网络不可用，造成主从同步问题；并未发现Broker自身出问题了。</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h2 id="系统监控分析"><a href="#系统监控分析" class="headerlink" title="系统监控分析"></a>系统监控分析</h2><h2 id="网络监控"><a href="#网络监控" class="headerlink" title="网络监控"></a>网络监控</h2><p>网络ping在问题时间段发送中断，网络没有流量。</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219074012.png"></p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219074030.png"></p>
<h2 id="磁盘IO监控"><a href="#磁盘IO监控" class="headerlink" title="磁盘IO监控"></a>磁盘IO监控</h2><p>在问题时间段磁盘IO有陡增</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219074123.png"></p>
<h2 id="CPU监控"><a href="#CPU监控" class="headerlink" title="CPU监控"></a>CPU监控</h2><p>CPU在问题时间段有飙高后回落</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219074154.png"></p>
<h2 id="内存信息"><a href="#内存信息" class="headerlink" title="内存信息"></a>内存信息</h2><p>内存信息没有采集到，由于当时网络中断了。</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219074213.png"></p>
<h2 id="集群流量"><a href="#集群流量" class="headerlink" title="集群流量"></a>集群流量</h2><p>除了网络终端未采集到数据外，问题时间断之前只有6000左右的TPS；网络恢复后有个脉冲到11301，然而总体负载很低。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020-03-16T17:54:05.037+08:00 bike_mq totalTps 6576</span><br><span class="line"></span><br><span class="line">2020-03-16T17:54:15.037+08:00 bike_mq totalTps 6375</span><br><span class="line"></span><br><span class="line">2020-03-16T17:54:25.037+08:00 bike_mq totalTps 6334</span><br><span class="line"></span><br><span class="line">2020-03-16T17:54:35.037+08:00 bike_mq totalTps 6048</span><br><span class="line"></span><br><span class="line">2020-03-16T17:54:45.037+08:00 bike_mq totalTps 6162</span><br><span class="line"></span><br><span class="line">2020-03-16T17:54:55.037+08:00 bike_mq totalTps 6123</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:50.208+08:00 bike_mq totalTps 5128</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:19.177+08:00 bike_mq totalTps 6240</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:24.44+08:00 bike_mq totalTps 11301</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:30.072+08:00 bike_mq totalTps 9577</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:31.334+08:00 bike_mq totalTps 9485</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:32.564+08:00 bike_mq totalTps 9190</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:33.79+08:00 bike_mq totalTps 7742</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:35.043+08:00 bike_mq totalTps 7323</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:36.269+08:00 bike_mq totalTps 7058</span><br><span class="line"></span><br><span class="line">2020-03-16T17:57:37.502+08:00 bike_mq totalTps 6697</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：通过监控看到在问题时间段网络、CPU、磁盘IO都出现了问题；到底是磁盘IO引起CPU飙高的？进而影响网络的；还是CPU先飙高引起网络中断和磁盘IO的。机器上只有一个RocketMQ进程，而且当时流量负载并不高；所以由应用进程导致CPU、网络、磁盘IO等问题是解释不通的。那会不会阿里云抖动呢？但是如果阿里云抖动为何只影响RocketMQ集群的3个节点呢？其他RocketMQ集群没有问题；业务机器也没有发现网络等问题。</span><br></pre></td></tr></table></figure>



<h1 id="Linux系统日志分析"><a href="#Linux系统日志分析" class="headerlink" title="Linux系统日志分析"></a>Linux系统日志分析</h1><p>通过查看问题时间段日志，发现页分配失败“page allocation failure. order:0, mode:0x20”，也就Page不够了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020-03-16T17:56:07.505715+08:00 VECS0xxxx kernel: &lt;IRQ&gt; [&lt;ffffffff81143c31&gt;] ? __alloc_pages_nodemask+0x7e1&#x2F;0x960</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505717+08:00 VECS0xxxx kernel: java: page allocation failure. order:0, mode:0x20</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505719+08:00 VECS0xxxx kernel: Pid: 12845, comm: java Not tainted 2.6.32-754.17.1.el6.x86_64 #1</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505721+08:00 VECS0xxxx kernel: Call Trace:</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505724+08:00 VECS0xxxx kernel: &lt;IRQ&gt; [&lt;ffffffff81143c31&gt;] ? __alloc_pages_nodemask+0x7e1&#x2F;0x960</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505726+08:00 VECS0xxxx kernel: [&lt;ffffffff8148e700&gt;] ? dev_queue_xmit+0xd0&#x2F;0x360</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505729+08:00 VECS0xxxx kernel: [&lt;ffffffff814cb3e2&gt;] ? ip_finish_output+0x192&#x2F;0x380</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505732+08:00 VECS0xxxx kernel: [&lt;ffffffff811862e2&gt;] ?</span><br></pre></td></tr></table></figure>



<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><h2 id="调整内核参数"><a href="#调整内核参数" class="headerlink" title="调整内核参数"></a>调整内核参数</h2><p>系统版本：CentOS 6.10 内核版本：Linux version 2.6.32-754.17.1.el6.x86_64</p>
<p>在sysctl.conf修改参数vm.zone_reclaim_mode和vm.min_free_kbytes。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"></span><br><span class="line">vm.zone_reclaim_mode &#x3D; 1</span><br><span class="line"></span><br><span class="line">vm.min_free_kbytes &#x3D; 512000</span><br><span class="line"></span><br><span class="line">sysctl -p &#x2F;etc&#x2F;sysctl.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：修改以上系统参数后，通过两天的观察，内核没有再抛“page allocation failure. order:0, mode:0x20”。</span><br></pre></td></tr></table></figure>

<p>参考文章</p>
<p><a href="https://access.redhat.com/solutions/90883">https://access.redhat.com/solutions/90883</a></p>
<p><a href="https://billtian.github.io/digoal.blog/2017/10/24/03.html">https://billtian.github.io/digoal.blog/2017/10/24/03.html</a></p>
<h2 id="参数含义说明"><a href="#参数含义说明" class="headerlink" title="参数含义说明"></a>参数含义说明</h2><p><strong>min_free_kbytes</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">This is used to force the Linux VM to keep a minimum number</span><br><span class="line"></span><br><span class="line">of kilobytes free. The VM uses this number to compute a</span><br><span class="line"></span><br><span class="line">watermark[WMARK_MIN] value for each lowmem zone in the system.</span><br><span class="line"></span><br><span class="line">Each lowmem zone gets a number of reserved free pages based</span><br><span class="line"></span><br><span class="line">proportionally on its size.</span><br><span class="line"></span><br><span class="line">Some minimal amount of memory is needed to satisfy PF_MEMALLOC</span><br><span class="line"></span><br><span class="line">allocations; if you set this to lower than 1024KB, your system will</span><br><span class="line"></span><br><span class="line">become subtly broken, and prone to deadlock under high loads.</span><br><span class="line"></span><br><span class="line">Setting this too high will OOM your machine instantly.</span><br></pre></td></tr></table></figure>



<p><strong>zone_reclaim_mode</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Zone_reclaim_mode allows someone to set more or less aggressive approaches to</span><br><span class="line"></span><br><span class="line">reclaim memory when a zone runs out of memory. If it is set to zero then no</span><br><span class="line"></span><br><span class="line">zone reclaim occurs. Allocations will be satisfied from other zones &#x2F; nodes</span><br><span class="line"></span><br><span class="line">in the system.</span><br><span class="line"></span><br><span class="line">This is value ORed together of</span><br><span class="line"></span><br><span class="line">1 &#x3D; Zone reclaim on</span><br><span class="line"></span><br><span class="line">2 &#x3D; Zone reclaim writes dirty pages out</span><br><span class="line"></span><br><span class="line">4 &#x3D; Zone reclaim swaps pages</span><br><span class="line"></span><br><span class="line">zone_reclaim_mode is disabled by default. For file servers or workloads</span><br><span class="line"></span><br><span class="line">that benefit from having their data cached, zone_reclaim_mode should be</span><br><span class="line"></span><br><span class="line">left disabled as the caching effect is likely to be more important than</span><br><span class="line"></span><br><span class="line">data locality.</span><br><span class="line"></span><br><span class="line">zone_reclaim may be enabled if it&#39;s known that the workload is partitioned</span><br><span class="line"></span><br><span class="line">such that each partition fits within a NUMA node and that accessing remote</span><br><span class="line"></span><br><span class="line">memory would cause a measurable performance reduction. The page allocator</span><br><span class="line"></span><br><span class="line">will then reclaim easily reusable pages (those page cache pages that are</span><br><span class="line"></span><br><span class="line">currently not used) before allocating off node pages.</span><br><span class="line"></span><br><span class="line">Allowing zone reclaim to write out pages stops processes that are</span><br><span class="line"></span><br><span class="line">writing large amounts of data from dirtying pages on other nodes. Zone</span><br><span class="line"></span><br><span class="line">reclaim will write out dirty pages if a zone fills up and so effectively</span><br><span class="line"></span><br><span class="line">throttle the process. This may decrease the performance of a single process</span><br><span class="line"></span><br><span class="line">since it cannot use all of system memory to buffer the outgoing writes</span><br><span class="line"></span><br><span class="line">anymore but it preserve the memory on other nodes so that the performance</span><br><span class="line"></span><br><span class="line">of other processes running on other nodes will not be affected.</span><br><span class="line"></span><br><span class="line">Allowing regular swap effectively restricts allocations to the local</span><br><span class="line"></span><br><span class="line">node unless explicitly overridden by memory policies or cpuset</span><br><span class="line"></span><br><span class="line">configurations.</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：zone_reclaim_mode默认为0即不启用zone_reclaim模式，1为打开zone_reclaim模式从本地节点回收内存；min_free_kbytesy允许内核使用的最小内存。</span><br></pre></td></tr></table></figure>

<h1 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h1><p>在系统空闲内存低于 watermark[low]时，开始启动内核线程kswapd进行内存回收，直到该zone的空闲内存数量达到watermark[high]后停止回收。如果上层申请内存的速度太快，导致空闲内存降至watermark[min]后，内核就会进行direct reclaim（直接回收），即直接在应用程序的进程上下文中进行回收，再用回收上来的空闲页满足内存申请，因此实际会阻塞应用程序，带来一定的响应延迟，而且可能会触发系统OOM。这是因为watermark[min]以下的内存属于系统的自留内存，用以满足特殊使用，所以不会给用户态的普通申请来用。</p>
<p><strong>min_free_kbytes大小的影响</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">min_free_kbytes设的越大，watermark的线越高，同时三个线之间的buffer量也相应会增加。这意味着会较早的启动kswapd进行回收，且会回收上来较多的内存（直至watermark[high]才会停止），这会使得系统预留过多的空闲内存，从而在一定程度上降低了应用程序可使用的内存量。极端情况下设置min_free_kbytes接近内存大小时，留给应用程序的内存就会太少而可能会频繁地导致OOM的发生。</span><br><span class="line"></span><br><span class="line">min_free_kbytes设的过小，则会导致系统预留内存过小。kswapd回收的过程中也会有少量的内存分配行为（会设上PF_MEMALLOC）标志，这个标志会允许kswapd使用预留内存；另外一种情况是被OOM选中杀死的进程在退出过程中，如果需要申请内存也可以使用预留部分。这两种情况下让他们使用预留内存可以避免系统进入deadlock状态。</span><br></pre></td></tr></table></figure>



<p><strong>三个watermark的计算方法</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">watermark[min] &#x3D; min_free_kbytes换算为page单位即可，假设为min_free_pages。（因为是每个zone各有一套watermark参数，实际计算效果是根据各个zone大小所占内存总大小的比例，而算出来的per zone min_free_pages） watermark[low] &#x3D; watermark[min] * 5 &#x2F; 4 watermark[high] &#x3D; watermark[min] * 3 &#x2F; 2</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：摘自“内存管理参数min_free_kbytes分析”，链接：https:&#x2F;&#x2F;www.dazhuanlan.com</span><br></pre></td></tr></table></figure></div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ19# RocketMQ集群CPU毛刺问题复盘</title>
    <url>/posts/649ec9da/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>RocketMQ从节点、主节点频繁CPU飙高，很明显的毛刺，很多次从节点直接挂掉了。</p>
<p>详情截图如下：</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219075750.png"></p>
<h1 id="集群情况"><a href="#集群情况" class="headerlink" title="集群情况"></a>集群情况</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">RocketMQ版本使用4.5.2，4主4从模式</span><br><span class="line"></span><br><span class="line">集群tps在8000左右</span><br><span class="line"></span><br><span class="line">单节点配置32C&#x2F;128G&#x2F;1.7T</span><br><span class="line"></span><br><span class="line">其中2从部署在阿里云ECS上，即一个集群6台ECS</span><br><span class="line"></span><br><span class="line">内核版本：Linux version 2.6.32-754.18.2.el6.x86_64 (mockbuild@x86-01.bsys.centos.org) (gcc version 4.4.7 20120313 (Red Hat 4.4.7-23) (GCC) ) #1 SMP Wed Aug 14 16:26:59 UTC 2019</span><br></pre></td></tr></table></figure>



<h1 id="内核参数"><a href="#内核参数" class="headerlink" title="内核参数"></a>内核参数</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vm.overcommit_memory&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.drop_caches&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.zone_reclaim_mode&#x3D;0</span><br><span class="line"></span><br><span class="line">vm.max_map_count&#x3D;655360</span><br><span class="line"></span><br><span class="line">vm.dirty_background_ratio&#x3D;50</span><br><span class="line"></span><br><span class="line">vm.dirty_ratio&#x3D;50</span><br><span class="line"></span><br><span class="line">vm.dirty_writeback_centisecs&#x3D;360000</span><br><span class="line"></span><br><span class="line">vm.page-cluster&#x3D;3</span><br><span class="line"></span><br><span class="line">vm.swappiness&#x3D;1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：搭建时的内核参数主从一致的，内容如上，之前使用该参数配置在RocketMQ集群4.1版本中，未发生任何异常情况。</span><br></pre></td></tr></table></figure>

<h1 id="从节点JVM参数"><a href="#从节点JVM参数" class="headerlink" title="从节点JVM参数"></a>从节点JVM参数</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;usr&#x2F;java&#x2F;jdk1.8.0_66&#x2F;bin&#x2F;java -server -Xms8g -Xmx8g -Xmn4g -XX:+UseG1GC -XX:G1HeapRegionSize&#x3D;16m -XX:G1ReservePercent&#x3D;25 -XX:InitiatingHeapOccupancyPercent&#x3D;30 -XX:SoftRefLRUPolicyMSPerMB&#x3D;0 -verbose:gc -Xloggc:&#x2F;dev&#x2F;shm&#x2F;rmq_broker_gc_%p_%t.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintAdaptiveSizePolicy -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles&#x3D;5 -XX:GCLogFileSize&#x3D;30m -XX:-OmitStackTraceInFastThrow -XX:+AlwaysPreTouch -XX:MaxDirectMemorySize&#x3D;15g -XX:-UseLargePages -XX:-UseBiasedLocking -Djava.ext.dirs&#x3D;&#x2F;usr&#x2F;java&#x2F;jdk1.8.0_66&#x2F;jre&#x2F;lib&#x2F;ext:&#x2F;workspace&#x2F;rocketmq-all-4.5.2-bin-release&#x2F;bin&#x2F;..&#x2F;lib -cp .:&#x2F;workspace&#x2F;rocketmq-all-4.5.2-bin-release&#x2F;bin&#x2F;..&#x2F;conf:.:&#x2F;usr&#x2F;java&#x2F;jdk1.8.0_66&#x2F;lib&#x2F;tools.jar:&#x2F;usr&#x2F;java&#x2F;jdk1.8.0_66&#x2F;lib&#x2F;dt.jar org.apache.rocketmq.broker.BrokerStartup -c &#x2F;workspace&#x2F;rocketmq-all-4.5.2-bin-release&#x2F;conf&#x2F;2m-2s-async&#x2F;broker-d-s.properties</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：堆内存分配为8G</span><br></pre></td></tr></table></figure>

<h1 id="问题详情"><a href="#问题详情" class="headerlink" title="问题详情"></a>问题详情</h1><h2 id="主节点出现闪断"><a href="#主节点出现闪断" class="headerlink" title="主节点出现闪断"></a>主节点出现闪断</h2><p>在3月16日出现了CPU sys飙高导致broker约有1分钟的不可用，具体系统日志错误为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2020-03-16T17:56:07.505715+08:00 VECS0xxxx kernel: &lt;IRQ&gt; [&lt;ffffffff81143c31&gt;] ? __alloc_pages_nodemask+0x7e1&#x2F;0x960</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505717+08:00 VECS0xxxx kernel: java: page allocation failure. order:0, mode:0x20</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505719+08:00 VECS0xxxx kernel: Pid: 12845, comm: java Not tainted 2.6.32-754.17.1.el6.x86_64 #1</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505721+08:00 VECS0xxxx kernel: Call Trace:</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505724+08:00 VECS0xxxx kernel: &lt;IRQ&gt; [&lt;ffffffff81143c31&gt;] ? __alloc_pages_nodemask+0x7e1&#x2F;0x960</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505726+08:00 VECS0xxxx kernel: [&lt;ffffffff8148e700&gt;] ? dev_queue_xmit+0xd0&#x2F;0x360</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505729+08:00 VECS0xxxx kernel: [&lt;ffffffff814cb3e2&gt;] ? ip_finish_output+0x192&#x2F;0x380</span><br><span class="line"></span><br><span class="line">2020-03-16T17:56:07.505732+08:00 VECS0xxxx kernel: [&lt;ffffffff811862e2&gt;] ?</span><br></pre></td></tr></table></figure>



<p>截图如下：</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219080000.png"></p>
<p>解决方式调整了主节点的内核参数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vm.zone_reclaim_mode &#x3D; 1</span><br><span class="line"></span><br><span class="line">vm.min_free_kbytes &#x3D; 512000</span><br></pre></td></tr></table></figure>



<p>当前主节点的内核参数配置为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vm.overcommit_memory&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.drop_caches&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.zone_reclaim_mode&#x3D;0</span><br><span class="line"></span><br><span class="line">vm.max_map_count&#x3D;655360</span><br><span class="line"></span><br><span class="line">vm.dirty_background_ratio&#x3D;25</span><br><span class="line"></span><br><span class="line">vm.dirty_ratio&#x3D;25</span><br><span class="line"></span><br><span class="line">vm.dirty_writeback_centisecs&#x3D;360000</span><br><span class="line"></span><br><span class="line">vm.page-cluster&#x3D;3</span><br><span class="line"></span><br><span class="line">vm.swappiness&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.zone_reclaim_mode &#x3D; 1</span><br><span class="line"></span><br><span class="line">vm.min_free_kbytes &#x3D; 512000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">备注：主节点详细过程参见下文：</span><br></pre></td></tr></table></figure>

<p>RocketMQ关于Broker闪断故障排查【实战笔记】</p>
<p><a href="https://mp.weixin.qq.com/s/8EE7_MqV-oZBYqtrdrlUIw">https://mp.weixin.qq.com/s/8EE7_MqV-oZBYqtrdrlUIw</a></p>
<h2 id="从节点挂掉情况"><a href="#从节点挂掉情况" class="headerlink" title="从节点挂掉情况"></a>从节点挂掉情况</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">调整主节点时把从节点也统一调整了，从节点也调整成了zone_reclaim_mode和min_free_kbytes参数</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vm.overcommit_memory&#x3D;0</span><br><span class="line"></span><br><span class="line">vm.drop_caches&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.zone_reclaim_mode&#x3D;0</span><br><span class="line"></span><br><span class="line">vm.max_map_count&#x3D;655360</span><br><span class="line"></span><br><span class="line">vm.dirty_background_ratio&#x3D;10</span><br><span class="line"></span><br><span class="line">vm.dirty_ratio&#x3D;10</span><br><span class="line"></span><br><span class="line">vm.dirty_writeback_centisecs&#x3D;360000</span><br><span class="line"></span><br><span class="line">vm.page-cluster&#x3D;3</span><br><span class="line"></span><br><span class="line">vm.swappiness&#x3D;1</span><br><span class="line"></span><br><span class="line">vm.zone_reclaim_mode &#x3D; 1</span><br><span class="line"></span><br><span class="line">vm.min_free_kbytes &#x3D; 512000</span><br></pre></td></tr></table></figure>



<p>此后从节点频繁出现了CPU飙高导致节点挂掉的情况，都是CPU sys在飙高，系统日志如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">30 2020-03-27T10:35:28.769900+08:00 VECSxxxx kernel: INFO: task AliYunDunUpdate:29054 blocked for more than 120 seconds.</span><br><span class="line"></span><br><span class="line">31 2020-03-27T10:35:28.769932+08:00 VECSxxxx kernel: Not tainted 2.6.32-754.17.1.el6.x86_64 #1</span><br><span class="line"></span><br><span class="line">32 2020-03-27T10:35:28.771650+08:00 VECS0xxxx kernel: &quot;echo 0 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;hung_task_timeout_secs&quot; disables this message.</span><br><span class="line"></span><br><span class="line">33 2020-03-27T10:35:28.774631+08:00 VECS0xxxx kernel: AliYunDunUpda D ffffffff815592fb 0 29054 1 0x10000080</span><br><span class="line"></span><br><span class="line">34 2020-03-27T10:35:28.777500+08:00 VECS0xxxx kernel: ffff8803ef75baa0 0000000000000082 ffff8803ef75ba68 ffff8803ef75ba64</span><br><span class="line"></span><br><span class="line">35 2020-03-27T10:35:28.780557+08:00 VECS0xxxx kernel: ffff8803ef75bae8 00000000000014a6 002d61b26118849c ffff880099b18c00</span><br><span class="line"></span><br><span class="line">36 2020-03-27T10:35:28.782853+08:00 VECS0xxxx kernel: 00000003f95c0502 0000000000000a2a ffff880488c665f8 ffff8803ef75bfd8</span><br></pre></td></tr></table></figure>



<p>为解决“blocked for more than 120 seconds”问题两次调整从节点dirty参数，从50%调整到25%后还是出现飙高情况，然后调整到10%，最终还是出现CPU飙高，截图如下：</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219080121.png"></p>
<p>系统message日志</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1656 2020-04-01T17:19:52.462310+08:00 VECS0xxxx kernel: INFO: task netstat:30311 blocked for more than 120 seconds.</span><br><span class="line"></span><br><span class="line">1657 2020-04-01T17:19:52.464266+08:00 VECS0xxx kernel: Not tainted 2.6.32-754.18.2.el6.x86_64 #1</span><br><span class="line"></span><br><span class="line">1658 2020-04-01T17:19:52.466011+08:00 VECS0xxxx kernel: &quot;echo 0 &gt; &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;hung_task_timeout_secs&quot; disables this messa ge.</span><br><span class="line"></span><br><span class="line">1659 2020-04-01T17:19:52.468971+08:00 VECS0xxxx kernel: netstat D ffffffff8160d9e0 0 30311 1 0x10000084</span><br><span class="line"></span><br><span class="line">1660 2020-04-01T17:19:52.471907+08:00 VECS0xxx kernel: ffff8801b0443d10 0000000000000082 0000000000000000 ffff88011ffc6ab0</span><br><span class="line"></span><br><span class="line">1661 2020-04-01T17:19:52.474211+08:00 VECS0xxxx kernel: ffff88000005b5c0 ffff88011ffc6ab0 0000275feaea8627 0000000000000002</span><br><span class="line"></span><br><span class="line">1662 2020-04-01T17:19:52.477311+08:00 VECS0xxxx kernel: 00000001029004e5 000000000000030f ffff88011ffc7068 ffff8801b0443fd8</span><br><span class="line"></span><br><span class="line">1663 2020-04-01T17:19:52.477323+08:00 VECS0xxxx kernel: Call Trace:</span><br><span class="line"></span><br><span class="line">1664 2020-04-01T17:19:52.478328+08:00 VECS0xxxx kernel: [&lt;ffffffff811c4b60&gt;] ? mntput_no_expire+0x30&#x2F;0x110</span><br><span class="line"></span><br><span class="line">1665 2020-04-01T17:19:52.482136+08:00 VECS0xxxx kernel: [&lt;ffffffff8155c6d5&gt;] rwsem_down_failed_common+0x95&#x2F;0x1d0</span><br><span class="line"></span><br><span class="line">1666 2020-04-01T17:19:52.482149+08:00 VECS0xxxx kernel: [&lt;ffffffff81244db5&gt;] ? security_inode_permission+0x25&#x2F;0x30</span><br></pre></td></tr></table></figure>



<h1 id="继续调整内核参数"><a href="#继续调整内核参数" class="headerlink" title="继续调整内核参数"></a>继续调整内核参数</h1><p>问题首先发生在主节点，调整min_free_kbytes和zone_reclaim_mode参数后，主节点问题没有再发生。是否由于把从节点的也调整了，导致了从节点CPU sys飙高挂掉？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">将min_free_kbytes调低来看下从节点的运行情况，将min_free_kbytes调低到128000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">小结：但是很遗憾，不管内核参数如何调整。CPU毛刺现象只能缓解，却不能有效根除。</span><br></pre></td></tr></table></figure>

<p>CPU spike on slave node: <a href="https://github.com/apache/rocketmq/issues/1910">https://github.com/apache/rocketmq/issues/1910</a></p>
<a id="more"></a>



<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>为此特在社区提了个问题，也得到了RocketMQ创始人冯嘉和RocketMQ Committer杜恒两位大佬的关注和指点。杜恒大佬有提Linux内核2.6的操作系统有bug会导致类似情况。回想一下原东家的RocketMQ集群运行以来从未出现过如此诡异现象，虽让好友将内核版本发与我，内核版本为3.10。</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219080227.png"></p>
<p>问题必须解决，这里是生产环境。所以对线上所有集群主从节点全部从centos6升级到centos7，内核版本也从从2.6升级到3.10。升级后通过半个月左右的观察，未出现CPU毛刺问题。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Linux version 3.10.0-1062.4.1.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC) ) #1 SMP Fri Oct 18 17:15:30 UTC 2019</span><br></pre></td></tr></table></figure>



</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ2# RocketMQ Consumer命令</title>
    <url>/posts/e790de00/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="创建订阅组"><a href="#创建订阅组" class="headerlink" title="创建订阅组"></a>创建订阅组</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin updateSubGroup -n localhost:9876 -c DefaultCluster -g zto-tst-consumer</span><br></pre></td></tr></table></figure>



<h1 id="删除订阅组"><a href="#删除订阅组" class="headerlink" title="删除订阅组"></a>删除订阅组</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin deleteSubGroup -n 192.168.1.x:9876 -c AdpMqCluster -g CODCANCELSIGN</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">delete subscription group [CODCANCELSIGN] from broker [192.168.1.x:10911] in cluster [AdpMqCluster] success.</span><br><span class="line"></span><br><span class="line">delete subscription group [CODCANCELSIGN] from broker [192.168.1.x:10911] in cluster [AdpMqCluster] success.</span><br><span class="line"></span><br><span class="line">delete subscription group [CODCANCELSIGN] from broker [192.168.1.x:10919] in cluster [AdpMqCluster] success.</span><br><span class="line"></span><br><span class="line">delete subscription group [CODCANCELSIGN] from broker [192.168.1.x:10915] in cluster [AdpMqCluster] success.</span><br><span class="line"></span><br><span class="line">delete subscription group [CODCANCELSIGN] from broker [192.168.1.x:10915] in cluster [AdpMqCluster] success.</span><br><span class="line"></span><br><span class="line">delete subscription group [CODCANCELSIGN] from broker [192.168.1.x:10919] in cluster [AdpMqCluster] success.</span><br><span class="line"></span><br><span class="line">delete topic [%RETRY%CODCANCELSIGN] from cluster [xMqCluster] success.</span><br><span class="line"></span><br><span class="line">delete topic [%RETRY%CODCANCELSIGN] from NameServer success.</span><br><span class="line"></span><br><span class="line">delete topic [%DLQ%CODCANCELSIGN] from cluster [xMqCluster] success.</span><br><span class="line"></span><br><span class="line">delete topic [%DLQ%CODCANCELSIGN] from NameServer success.</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="查看消费组情况及IP地址"><a href="#查看消费组情况及IP地址" class="headerlink" title="查看消费组情况及IP地址"></a>查看消费组情况及IP地址</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin consumerStatus -g TraceToCaiNiao -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">001 192.168.12.122@25063 V3_5_8 1539756615406&#x2F;192.168.x.x@25063</span><br><span class="line"></span><br><span class="line">002 192.168.13.96@3351 V3_5_8 1539756615406&#x2F;192.168.x.x@3351</span><br><span class="line"></span><br><span class="line">003 192.168.x.x@13385 V3_5_8 1539756615406&#x2F;192.168.x.x@13385</span><br><span class="line"></span><br><span class="line">004 192.168.x.x@6691 V3_5_8 1539756615406&#x2F;192.168.x.x@6691</span><br></pre></td></tr></table></figure>



<h1 id="查看消费组情况"><a href="#查看消费组情况" class="headerlink" title="查看消费组情况"></a>查看消费组情况</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin consumerProgress -n 192.168.1.x:9876 -g SortComplementConsumer</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Topic Broker Name QID Broker Offset Consumer Offset Diff LastTime</span><br><span class="line"></span><br><span class="line">%RETRY%SortComplementConsumer broker-a 0 1 1 0 2018-10-22 12:43:13</span><br><span class="line"></span><br><span class="line">%RETRY%SortComplementConsumer broker-b 0 2 2 0 2018-10-22 12:43:13</span><br><span class="line"></span><br><span class="line">%RETRY%SortComplementConsumer broker-c 0 2 2 0 2018-10-22 12:43:28</span><br><span class="line"></span><br><span class="line">%RETRY%SortComplementConsumer broker-d 0 2 2 0 2018-10-22 12:44:33</span><br><span class="line"></span><br><span class="line">SCANRECORD broker-a 0 39717505 39717502 3 2018-10-22 13:53:21</span><br><span class="line"></span><br><span class="line">SCANRECORD broker-a 1 39721504 39721502 2 2018-10-22 13:53:21</span><br><span class="line"></span><br><span class="line">SCANRECORD broker-a 2 39733704 39733703 1 2018-10-22 13:53:21</span><br></pre></td></tr></table></figure>





</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ20# RocketMQ集群实现平滑扩缩容</title>
    <url>/posts/69ff2739/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="运维需求"><a href="#运维需求" class="headerlink" title="运维需求"></a>运维需求</h1><p>在RocketMQ集群的实践中，对集群扩容、缩容、节点下线等运维做到平滑、业务无感知、数据无丢失，这个对于集群运维的同学来说非常重要。</p>
<p>比如前些日子出现的问题，由于线上集群频繁出现CPU毛刺甚至直接挂掉并伴随着集群抖动，对内核参数的调整只能减缓毛刺却不能消除抖动。集群抖动业务使用会伴随着发送延迟告警，始终是个必须处理的隐患。最终决定更换操作系统即更换内核。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">集群信息: RocketMQ版本4.5.2</span><br><span class="line"></span><br><span class="line">主从信息：4主4从 broker-a, broker-b, broker-c, broker-d,</span><br><span class="line"></span><br><span class="line">broker-a(slave), broker-b(slave), broker-c(slave), broker-d(slave)</span><br></pre></td></tr></table></figure>

<p>操作系统: centos6</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Linux version 2.6.32-754.18.2.el6.x86_64 (mockbuild@x86-01.bsys.centos.org) (gcc version 4.4.7 20120313 (Red Hat 4.4.7-23) (GCC) ) #1 SMP Wed Aug 14 16:26:59 UTC 2019</span><br></pre></td></tr></table></figure>

<p>目标系统：centos7</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Linux version 3.10.0-1062.4.1.el7.x86_64 (mockbuild@kbuilder.bsys.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC) ) #1 SMP Fri Oct 18 17:15:30 UTC 2019</span><br></pre></td></tr></table></figure>



<p>集群的部署如下下图所示：</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219080526.png"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">其需要简单概括如下，就是要将上述集群的操作系统内核从 Centos6 升级到 Centos7,但业务不能停。</span><br></pre></td></tr></table></figure>



<h1 id="平滑扩容"><a href="#平滑扩容" class="headerlink" title="平滑扩容"></a>平滑扩容</h1><h2 id="下线从节点"><a href="#下线从节点" class="headerlink" title="下线从节点"></a>下线从节点</h2><p>从节点正常关闭rocketmq，从节点下线对业务不会造成影响，如果配置，slaveReadEnable=true，从节点的通常在消息回溯延迟超过内存消息的40%时使用。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqshutdown broker</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">kill pid</span><br></pre></td></tr></table></figure>



<p>从节点下线之后，集群的部署情况如下图所示：</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219080558.png"></p>
<p>直接停掉从节点，并不影响当前业务的使用，因为写，读都可以通过主节点，对业务无影响。</p>
<h2 id="重组主从模式"><a href="#重组主从模式" class="headerlink" title="重组主从模式"></a>重组主从模式</h2><p>新申请4台机器与原从节点重新组合成主从关系。</p>
<p>具体操作为将新申请的4台机器的内核全部升级为Centos7内核，并部署为 broker-a1,broker-b1,broker-c1,broker-d1，这里如果使用 broker-e,f,f,h 命名，会造成流量切斜，导致消费不均衡，原因在文末会给出，大家不妨思考一下。</p>
<p>然后将上一步下掉的从节点，其内核全部升级为 centos7的内核。并将这些节点设置为新增4个主节点的从，其部署结构如下图所示：</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219080619.png"></p>
<p>此时集群中变成8主，其中新增集群有从节点，即装有centor7内核的新机器构成了4主4从，接下来就只需要将内核为centos6的主节点的数据消费完成，并下线即可。</p>
<a id="more"></a>



<h1 id="平滑缩容"><a href="#平滑缩容" class="headerlink" title="平滑缩容"></a>平滑缩容</h1><p>接下来主要是将装有centos6内核的旧机器从集群中移除，具体操作如下。</p>
<h2 id="关闭broker写权限"><a href="#关闭broker写权限" class="headerlink" title="关闭broker写权限"></a>关闭broker写权限</h2><p>逐台关闭 broker-a, broker-b, broker-c, broker-d 的写入权限，其中4表示只读权限，6表示读写权限。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin updateBrokerConfig -b x.x.x.x:10911 -n x.x.x.x:9876 -k brokerPermission -v 4</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">update broker config success, x.x.x.x:10911</span><br></pre></td></tr></table></figure>



<h2 id="验证broker流量情况"><a href="#验证broker流量情况" class="headerlink" title="验证broker流量情况"></a>验证broker流量情况</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin clusterList -n x.x.x.x:9876</span><br></pre></td></tr></table></figure>

<p>等待broker出入流量均归零</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219080712.png"></p>
<p>验证broker积压情况</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin brokerConsumeStats -b x.x.x.x:10911 -n x.x.x.x:9876</span><br></pre></td></tr></table></figure>



<p>观察最后一行Diff Total等于0时表示该节点已经没有积压，即全部消费完毕。</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219080746.png"></p>
<h2 id="节点下线"><a href="#节点下线" class="headerlink" title="节点下线"></a>节点下线</h2><p>当节点流量和积压都为0时，节点可以下线了。如果broker一直有流量或者积压一直存在呢？通常线上集群的存储时间为2～3天；可以在过了存储时间后再安排下线。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqshutdown broker</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">kill pid</span><br></pre></td></tr></table></figure>



<h1 id="问题答疑"><a href="#问题答疑" class="headerlink" title="问题答疑"></a>问题答疑</h1><p>上文中有提到过扩容新增节点时命名时不要使用 broker-e, broker-f, broker-g, broker-h；而采用broker-a1, broker-b1, broker-c1, broker-d1。</p>
<p>按照默认平均分配消费算法，如果采用第一种命名，当关闭broker-a, broker-b, broker-c, broker-d的写入权限时，数据会全部集中在broker-e, broker-f, broker-g, broker-h节点，假如线上部署了四台消费机器，会有两台机器分到broker-a, broker-b, broker-c, broker-d的分区，而另外两台机器分到broker-e, broker-f, broker-g, broker-h的分区。</p>
<p>而broker-a, broker-b, broker-c, broker-d节点的写权限被关闭后，会造成其中两台节点无数据，数据全部分配到另外的消费机器上。</p>
<p>因为只是关闭了broker-a,b,c,d的写权限，读权限未关闭，但如果使用broker-a,a1，b,b1这种命名方式，就能平衡其流量，不至于连续出现大部分队列上无数据的情况，使消费者负载趋于均衡。</p>
<p>在不影响业务的情况下，把集群内所有的节点全部重新更新内核就是这么溜，欢迎留言与作者互动，共同交流。</p>
</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ21# 为何建议关闭RocketMQ预热配置</title>
    <url>/posts/a46a67ee/</url>
    <content><![CDATA[<div id="vip-container"><p>RocketMQ提供了一个预热配置项warmMapedFileEnable默认为关闭状态。曾在文章RocketMQ存储–映射文件预热【源码笔记】分析过文件预热流程。在预热文件时会填充1个G的假值0作为占位符，提前分配物理内存，防止消息写入时发生缺页异常。如此特性正如文章标题所说，为何建议关闭RocketMQ预热配置呢？</p>
<h1 id="服务端监控"><a href="#服务端监控" class="headerlink" title="服务端监控"></a>服务端监控</h1><h2 id="日志监控"><a href="#日志监控" class="headerlink" title="日志监控"></a>日志监控</h2><p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081057.png"></p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081114.png"></p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081131.png"></p>
<h2 id="CPU情况"><a href="#CPU情况" class="headerlink" title="CPU情况"></a>CPU情况</h2><p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081205.png"></p>
<p>由服务端日志可以看出，在预热时broker会发生较长的耗时，10～30秒不等，CPU也会有小幅抖动，这会造成什么影响呢？接着看下文</p>
<a id="more"></a>



<h1 id="客户端发送监控"><a href="#客户端发送监控" class="headerlink" title="客户端发送监控"></a>客户端发送监控</h1><p>在broker预热时，客户端耗时长达5秒。</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081226.png"></p>
<p>在broker预热时，客户端耗时长达6秒</p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081243.png"></p>
<p>在此时间段，业务应用伴随着大量超时报警。</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>在broker预热时，往往伴随着磁盘写入耗时过长、CPU小幅抖动、业务具体表现为发送耗时过长，超时错误增多。关闭预热配置从集群TPS摸高情况来看并未有明显的差异，但是从稳定性角度关闭却很有必要。</p>
</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ21# 为何建议关闭RocketMQ预热配置</title>
    <url>/posts/a46a67ee/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>RocketMQ配置中有一个设置项为transferMsgByHeap，即是否通过堆内存传输数据。在文章“RocketMQ存储–同步刷盘和异步刷盘”中对其进行过梳理。那transferMsgByHeap是开启好呢？还是关闭好！第二个问题是可以设置消费的线程数，由于无界队列所以只需要设置最小线程数consumeThreadMin即可，那在rocket-client4.7版本中还能这么用吗？</p>
<h1 id="transferMsgByHeap误解"><a href="#transferMsgByHeap误解" class="headerlink" title="transferMsgByHeap误解"></a>transferMsgByHeap误解</h1><p>transferMsgByHeap设置为false时，通过堆外内存传输数据，相比堆内存传输减少了数据拷贝、零字节拷贝、效率更高，所以关闭transferMsgByHeap应该成为我们的优先选择，但是实践来看，你或许会改变想法，下面是transferMsgByHeap=false，客户端大量超时错误时的日志截图。</p>
<h2 id="Broker日志截图"><a href="#Broker日志截图" class="headerlink" title="Broker日志截图"></a>Broker日志截图</h2><p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081609.png"></p>
<h2 id="CPU日志截图"><a href="#CPU日志截图" class="headerlink" title="CPU日志截图"></a>CPU日志截图</h2><p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081632.png"></p>
<h2 id="系统日志截图"><a href="#系统日志截图" class="headerlink" title="系统日志截图"></a>系统日志截图</h2><p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219081704.png"></p>
<h2 id="源码报错截图"><a href="#源码报错截图" class="headerlink" title="源码报错截图"></a>源码报错截图</h2><p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219082807.png"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">小结：你看到这里会发现，在关闭transferMsgByHeap时，可能造成堆外内存分配不够，触发系统内存回收和落盘操作。此时CPU会有一个陡坡，具体客户端表现为发送大量超时。解决方式开启transferMsgByHeap即可，让运行更加平稳。</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="消费的最小线程数"><a href="#消费的最小线程数" class="headerlink" title="消费的最小线程数"></a>消费的最小线程数</h1><p>我们在使用rocketmq消费时，有两个参数consumeThreadMin和consumeThreadMax。在以往的版本中，我们只需要设置consumeThreadMin即可，例如consumeThreadMin=64。在rocket-client4.7版本中，如果设置consumeThreadMin=64会导致消费失败，下面看下原因。</p>
<h2 id="错误提示"><a href="#错误提示" class="headerlink" title="错误提示"></a>错误提示</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">org.apache.rocketmq.client.exception.MQClientException: consumeThreadMin (64) is larger than consumeThreadMax (20)</span><br></pre></td></tr></table></figure>



<h2 id="源码原因"><a href="#源码原因" class="headerlink" title="源码原因"></a>源码原因</h2><p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219082853.png"></p>
<p><img src="https://gitee.com/laoliangcode/md-picture/raw/master/img/20201219082913.png"></p>
<p>小结：在rocketmq-client新版本中，增加了consumeThreadMax的判断。当consumeThreadMin大于20时需要同时设置consumeThreadMax，所以单独设置consumeThreadMin=64会抛出错误导致消费失败。</p>
</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ3# RocketMQ Cluster命令</title>
    <url>/posts/a3779249/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="查看集群信息"><a href="#查看集群信息" class="headerlink" title="查看集群信息"></a>查看集群信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin clusterList -n localhost:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Cluster Name Broker Name BID Addr Version InTPS OutTPS</span><br><span class="line"></span><br><span class="line">AdpMqCluster broker-a 0 192.168.1.x:10911 V3_4_6 2819.22 1077.39</span><br><span class="line"></span><br><span class="line">AdpMqCluster broker-b 0 192.168.1.x:10911 V3_4_6 2839.42 1070.89</span><br><span class="line"></span><br><span class="line">AdpMqCluster broker-c 0 192.168.1.x:10919 V3_4_6 2800.12 1058.39</span><br><span class="line"></span><br><span class="line">AdpMqCluster broker-d 0 192.168.1.x:10915 V3_4_6 2897.04 1126.04</span><br><span class="line"></span><br><span class="line">AdpMqCluster broker-e 0 192.168.1.x:10919 V3_4_6 2987.20 1181.88</span><br><span class="line"></span><br><span class="line">AdpMqCluster broker-f 0 192.168.1.x:10915 V3_4_6 3010.40 1187.08</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="创建Topic"><a href="#创建Topic" class="headerlink" title="创建Topic"></a>创建Topic</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin updateTopic -n localhost:9876 -c DefaultCluster -t zto-example</span><br></pre></td></tr></table></figure>



<h1 id="删除Topic"><a href="#删除Topic" class="headerlink" title="删除Topic"></a>删除Topic</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin deleteTopic -n localhost:9876 -c DefaultCluster -t zto-example</span><br></pre></td></tr></table></figure></div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ4# 查看RocketMQ Tps命令</title>
    <url>/posts/ba08ed95/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="查看所有Topic吞吐Tps"><a href="#查看所有Topic吞吐Tps" class="headerlink" title="查看所有Topic吞吐Tps"></a>查看所有Topic吞吐Tps</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin statsAll -n localhost:9876</span><br><span class="line"></span><br><span class="line">Topic Consumer Group InTPS OutTPS InMsg24Hour OutMsg24Hour</span><br><span class="line"></span><br><span class="line">T_SCANRECORD_NEW_groy 0.00 0 NO_CONSUMER</span><br><span class="line"></span><br><span class="line">T_SCANRECORD_NEW internationalScanRecordAll 5480.10 0.00 310165682 0</span><br><span class="line"></span><br><span class="line">T_SCANRECORD_NEW realnameConsumer 5480.10 79.98 310165682 29896917</span><br><span class="line"></span><br><span class="line">T_SCANRECORD_NEW AdpMqCluster_consumer2 5480.10 0.00 310165682 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="查看特定Topic的吞吐Tps"><a href="#查看特定Topic的吞吐Tps" class="headerlink" title="查看特定Topic的吞吐Tps"></a>查看特定Topic的吞吐Tps</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin statsAll -t SCANRECORD -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Topic Consumer Group Accumulation InTPS OutTPS InMsg24Hour OutMsg24Hour</span><br><span class="line"></span><br><span class="line">SCANRECORD ZtoSignGroup 5826 2086.33 44.00 246409321 29988099</span><br><span class="line"></span><br><span class="line">SCANRECORD newOpenPartnerDeadlineJob 5447 2086.33 44.00 246409321 29988099</span><br><span class="line"></span><br><span class="line">SCANRECORD smartidivision-scanrecord-dis 3523 2086.33 14.32 246409321 31212557</span><br></pre></td></tr></table></figure></div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ5# RocketMQ Broker命令</title>
    <url>/posts/138ff78c/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="查看broker状态信息"><a href="#查看broker状态信息" class="headerlink" title="查看broker状态信息"></a>查看broker状态信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin brokerStatus -b 192.168.1.x:10911 -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">bootTimestamp : 1535597348792</span><br><span class="line"></span><br><span class="line">brokerVersion : 232</span><br><span class="line"></span><br><span class="line">brokerVersionDesc : V4_1_0_SNAPSHOT</span><br><span class="line"></span><br><span class="line">commitLogDirCapacity : Total : 8.7 TiB, Free : 7.7 TiB.</span><br><span class="line"></span><br><span class="line">commitLogDiskRatio : 0.11147464487710743</span><br><span class="line"></span><br><span class="line">commitLogMaxOffset : 6652182757965</span><br><span class="line"></span><br><span class="line">commitLogMinOffset : 5676873023488</span><br><span class="line"></span><br><span class="line">consumeQueueDiskRatio : 0.11147464487710743</span><br><span class="line"></span><br><span class="line">dispatchBehindBytes : 0</span><br><span class="line"></span><br><span class="line">dispatchMaxBuffer : 0</span><br><span class="line"></span><br><span class="line">earliestMessageTimeStamp : 1539290831130</span><br><span class="line"></span><br><span class="line">getFoundTps : 24229.27707229277 24670.716261707163 24323.07766631239</span><br><span class="line"></span><br><span class="line">getMessageEntireTimeMax : 4895</span><br><span class="line"></span><br><span class="line">getMissTps : 23384.56154384562 24047.195280471955 23735.196223133637</span><br><span class="line"></span><br><span class="line">getTotalTps : 47613.83861613839 48717.91154217912 48058.27388944603</span><br><span class="line"></span><br><span class="line">getTransferedTps : 28046.395360463954 28519.931340199313 28905.699949690646</span><br><span class="line"></span><br><span class="line">msgGetTotalTodayMorning : 30682264110</span><br><span class="line"></span><br><span class="line">msgGetTotalTodayNow : 31750490006</span><br><span class="line"></span><br><span class="line">msgGetTotalYesterdayMorning : 29219504313</span><br><span class="line"></span><br><span class="line">msgPutTotalTodayMorning : 7329767893</span><br><span class="line"></span><br><span class="line">msgPutTotalTodayNow : 7523090457</span><br><span class="line"></span><br><span class="line">msgPutTotalYesterdayMorning : 7031035625</span><br><span class="line"></span><br><span class="line">pageCacheLockTimeMills : 0</span><br><span class="line"></span><br><span class="line">pullThreadPoolQueueCapacity : 100000</span><br><span class="line"></span><br><span class="line">pullThreadPoolQueueHeadWaitTimeMills: 0</span><br><span class="line"></span><br><span class="line">pullThreadPoolQueueSize : 0</span><br><span class="line"></span><br><span class="line">putMessageAverageSize : 807.2943103360182</span><br><span class="line"></span><br><span class="line">putMessageDistributeTime : [&lt;&#x3D;0ms]:229497 [0~10ms]:1275 [10~50ms]:4 [50~100ms]:0 [100~200ms]:0 [200~500ms]:0 [500ms~1s]:0 [1~2s]:0 [2~3s]:0 [3~4s]:0 [4~5s]:0 [5~10s]:0 [10s~]:0</span><br><span class="line"></span><br><span class="line">putMessageEntireTimeMax : 10885</span><br><span class="line"></span><br><span class="line">putMessageSizeTotal : 6073348121272</span><br><span class="line"></span><br><span class="line">putMessageTimesTotal : 7523090456</span><br><span class="line"></span><br><span class="line">putTps : 4424.957504249575 4466.0700596607 4577.724617932119</span><br><span class="line"></span><br><span class="line">remainHowManyDataToCommit : 6.9 KiB</span><br><span class="line"></span><br><span class="line">remainHowManyDataToFlush : 0 B</span><br><span class="line"></span><br><span class="line">remainTransientStoreBufferNumbs : 3</span><br><span class="line"></span><br><span class="line">runtime : [ 48 days, 7 hours, 52 minutes, 34 seconds ]</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_1 : 5169358,5169358</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_10 : 8161108,8171531</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_11 : 7864781,7877885</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_12 : 7584977,7601110</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_13 : 7278660,7297334</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_14 : 7123700,7146082</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_15 : 7013493,7063463</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_16 : 6864847,6950753</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_17 : 6549491,6803414</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_18 : 12887811,12894744</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_3 : 13667462,13667752</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_4 : 9780224,9781009</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_5 : 63142105,63144981</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_6 : 9185173,9188251</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_7 : 9002046,9006727</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_8 : 8834782,8841531</span><br><span class="line"></span><br><span class="line">scheduleMessageOffset_9 : 1112865066,1112879874</span><br><span class="line"></span><br><span class="line">sendThreadPoolQueueCapacity : 10000</span><br><span class="line"></span><br><span class="line">sendThreadPoolQueueHeadWaitTimeMills: 0</span><br><span class="line"></span><br><span class="line">sendThreadPoolQueueSize : 0</span><br><span class="line"></span><br><span class="line">startAcceptSendRequestTimeStamp : 0</span><br><span class="line"></span><br><span class="line">You have mail in &#x2F;var&#x2F;spool&#x2F;mail&#x2F;root</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin brokerConsumeStats -b 192.168.1.x:10911 -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">zeus-package-mismatch-topic zeus-package-mismatch-consumer broker-a 0 698533 698532 1 2018-10-17 18:35:58</span><br><span class="line"></span><br><span class="line">zeus-package-mismatch-topic zeus-package-mismatch-consumer broker-a 1 698521 698520 1 2018-10-17 18:36:01</span><br><span class="line"></span><br><span class="line">zeus-package-mismatch-topic zeus-package-mismatch-consumer broker-a 2 698514 698513 1 2018-10-17 18:36:01</span><br><span class="line"></span><br><span class="line">zeus-package-mismatch-topic zeus-package-mismatch-consumer broker-a 3 698495 698494 1 2018-10-17 18:36:01</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="清除废弃的ConsumeQueue"><a href="#清除废弃的ConsumeQueue" class="headerlink" title="清除废弃的ConsumeQueue"></a>清除废弃的ConsumeQueue</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin cleanExpiredCQ -b 192.168.1.x:10911 -n 192.168.1.x:9876</span><br></pre></td></tr></table></figure>



<h1 id="清除废弃的Topic"><a href="#清除废弃的Topic" class="headerlink" title="清除废弃的Topic"></a>清除废弃的Topic</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin cleanUnusedTopic -b 192.168.1.x:10911 -n 192.168.1.x:9876</span><br></pre></td></tr></table></figure>



<h1 id="获取broker配置信息"><a href="#获取broker配置信息" class="headerlink" title="获取broker配置信息"></a>获取broker配置信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin getBrokerConfig -b 192.168.1.x:10911 -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;192.168.1.x:10911&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">autoCreateSubscriptionGroup &#x3D; false</span><br><span class="line"></span><br><span class="line">brokerName &#x3D; broker-a</span><br><span class="line"></span><br><span class="line">haListenPort &#x3D; 10912</span><br><span class="line"></span><br><span class="line">clientManagerThreadPoolQueueCapacity &#x3D; 1000000</span><br><span class="line"></span><br><span class="line">flushCommitLogThoroughInterval &#x3D; 10000</span><br><span class="line"></span><br><span class="line">flushCommitLogLeastPages &#x3D; 4</span><br><span class="line"></span><br><span class="line">clientCallbackExecutorThreads &#x3D; 48</span><br><span class="line"></span><br><span class="line">notifyConsumerIdsChangedEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">cleanResourceInterval &#x3D; 10000</span><br><span class="line"></span><br><span class="line">channelNotActiveInterval &#x3D; 60000</span><br><span class="line"></span><br><span class="line">diskMaxUsedSpaceRatio &#x3D; 88</span><br><span class="line"></span><br><span class="line">debugLockEnable &#x3D; false</span><br><span class="line"></span><br><span class="line">messageDelayLevel &#x3D; 1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h</span><br><span class="line"></span><br><span class="line">clusterTopicEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">messageIndexEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">serverPooledByteBufAllocatorEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">shortPollingTimeMills &#x3D; 1000</span><br><span class="line"></span><br><span class="line">commercialEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">redeleteHangedFileInterval &#x3D; 120000</span><br><span class="line"></span><br><span class="line">flushConsumerOffsetInterval &#x3D; 5000</span><br><span class="line"></span><br><span class="line">flushCommitLogTimed &#x3D; false</span><br><span class="line"></span><br><span class="line">maxMessageSize &#x3D; 65536</span><br><span class="line"></span><br><span class="line">brokerId &#x3D; 0</span><br><span class="line"></span><br><span class="line">syncFlushTimeout &#x3D; 5000</span><br><span class="line"></span><br><span class="line">flushConsumeQueueThoroughInterval &#x3D; 60000</span><br><span class="line"></span><br><span class="line">clientChannelMaxIdleTimeSeconds &#x3D; 120</span><br><span class="line"></span><br><span class="line">flushDelayOffsetInterval &#x3D; 10000</span><br><span class="line"></span><br><span class="line">serverSocketRcvBufSize &#x3D; 131072</span><br><span class="line"></span><br><span class="line">flushDiskType &#x3D; ASYNC_FLUSH</span><br><span class="line"></span><br><span class="line">maxTransferBytesOnMessageInMemory &#x3D; 262144</span><br><span class="line"></span><br><span class="line">clientManageThreadPoolNums &#x3D; 32</span><br><span class="line"></span><br><span class="line">serverChannelMaxIdleTimeSeconds &#x3D; 120</span><br><span class="line"></span><br><span class="line">serverCallbackExecutorThreads &#x3D; 0</span><br><span class="line"></span><br><span class="line">transientStorePoolSize &#x3D; 5</span><br><span class="line"></span><br><span class="line">maxTransferBytesOnMessageInDisk &#x3D; 65536</span><br><span class="line"></span><br><span class="line">pullMessageThreadPoolNums &#x3D; 128</span><br><span class="line"></span><br><span class="line">clientCloseSocketIfTimeout &#x3D; false</span><br><span class="line"></span><br><span class="line">fetchNamesrvAddrByAddressServer &#x3D; false</span><br><span class="line"></span><br><span class="line">sendThreadPoolQueueCapacity &#x3D; 10000</span><br><span class="line"></span><br><span class="line">diskFallRecorded &#x3D; true</span><br><span class="line"></span><br><span class="line">transientStorePoolEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">offsetCheckInSlave &#x3D; false</span><br><span class="line"></span><br><span class="line">disableConsumeIfConsumerReadSlowly &#x3D; false</span><br><span class="line"></span><br><span class="line">commitCommitLogThoroughInterval &#x3D; 200</span><br><span class="line"></span><br><span class="line">consumerManagerThreadPoolQueueCapacity &#x3D; 1000000</span><br><span class="line"></span><br><span class="line">flushIntervalConsumeQueue &#x3D; 1000</span><br><span class="line"></span><br><span class="line">clientOnewaySemaphoreValue &#x3D; 65535</span><br><span class="line"></span><br><span class="line">warmMapedFileEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">slaveReadEnable &#x3D; false</span><br><span class="line"></span><br><span class="line">transferMsgByHeap &#x3D; true</span><br><span class="line"></span><br><span class="line">consumerFallbehindThreshold &#x3D; 17179869184</span><br><span class="line"></span><br><span class="line">serverAsyncSemaphoreValue &#x3D; 64</span><br><span class="line"></span><br><span class="line">startAcceptSendRequestTimeStamp &#x3D; 0</span><br><span class="line"></span><br><span class="line">flushConsumerOffsetHistoryInterval &#x3D; 60000</span><br><span class="line"></span><br><span class="line">brokerIP2 &#x3D; 192.168.1.x</span><br><span class="line"></span><br><span class="line">maxTransferCountOnMessageInDisk &#x3D; 8</span><br><span class="line"></span><br><span class="line">brokerIP1 &#x3D; 192.168.1.x</span><br><span class="line"></span><br><span class="line">deleteCommitLogFilesInterval &#x3D; 100</span><br><span class="line"></span><br><span class="line">adminBrokerThreadPoolNums &#x3D; 16</span><br><span class="line"></span><br><span class="line">storePathCommitLog &#x3D; &#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;commitlog</span><br><span class="line"></span><br><span class="line">filterServerNums &#x3D; 0</span><br><span class="line"></span><br><span class="line">deleteConsumeQueueFilesInterval &#x3D; 100</span><br><span class="line"></span><br><span class="line">checkCRCOnRecover &#x3D; true</span><br><span class="line"></span><br><span class="line">serverOnewaySemaphoreValue &#x3D; 256</span><br><span class="line"></span><br><span class="line">defaultQueryMaxNum &#x3D; 32</span><br><span class="line"></span><br><span class="line">clientWorkerThreads &#x3D; 4</span><br><span class="line"></span><br><span class="line">clientSocketRcvBufSize &#x3D; 131072</span><br><span class="line"></span><br><span class="line">maxDelayTime &#x3D; 40</span><br><span class="line"></span><br><span class="line">connectTimeoutMillis &#x3D; 3000</span><br><span class="line"></span><br><span class="line">clientPooledByteBufAllocatorEnable &#x3D; false</span><br><span class="line"></span><br><span class="line">commercialTimerCount &#x3D; 1</span><br><span class="line"></span><br><span class="line">serverSocketSndBufSize &#x3D; 131072</span><br><span class="line"></span><br><span class="line">regionId &#x3D; DefaultRegion</span><br><span class="line"></span><br><span class="line">duplicationEnable &#x3D; false</span><br><span class="line"></span><br><span class="line">cleanFileForciblyEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">fastFailIfNoBufferInStorePool &#x3D; false</span><br><span class="line"></span><br><span class="line">rejectTransactionMessage &#x3D; false</span><br><span class="line"></span><br><span class="line">serverSelectorThreads &#x3D; 3</span><br><span class="line"></span><br><span class="line">consumerManageThreadPoolNums &#x3D; 32</span><br><span class="line"></span><br><span class="line">haSendHeartbeatInterval &#x3D; 5000</span><br><span class="line"></span><br><span class="line">mapedFileSizeConsumeQueue &#x3D; 50000000</span><br><span class="line"></span><br><span class="line">storeCheckpoint &#x3D; &#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;checkpoint</span><br><span class="line"></span><br><span class="line">commitCommitLogLeastPages &#x3D; 4</span><br><span class="line"></span><br><span class="line">longPollingEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">flushConsumeQueueLeastPages &#x3D; 2</span><br><span class="line"></span><br><span class="line">storePathRootDir &#x3D; &#x2F;data&#x2F;rocketmq&#x2F;store</span><br><span class="line"></span><br><span class="line">defaultTopicQueueNums &#x3D; 4</span><br><span class="line"></span><br><span class="line">highSpeedMode &#x3D; false</span><br><span class="line"></span><br><span class="line">commercialBaseCount &#x3D; 1</span><br><span class="line"></span><br><span class="line">checkTransactionMessageEnable &#x3D; false</span><br><span class="line"></span><br><span class="line">accessMessageInMemoryMaxRatio &#x3D; 40</span><br><span class="line"></span><br><span class="line">autoCreateTopicEnable &#x3D; false</span><br><span class="line"></span><br><span class="line">commitIntervalCommitLog &#x3D; 200</span><br><span class="line"></span><br><span class="line">brokerTopicEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">namesrvAddr &#x3D; 192.168.1.x:9876;192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">clientAsyncSemaphoreValue &#x3D; 65535</span><br><span class="line"></span><br><span class="line">maxMsgsNumBatch &#x3D; 64</span><br><span class="line"></span><br><span class="line">storePathConsumeQueue &#x3D; &#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;consumequeue</span><br><span class="line"></span><br><span class="line">fileReservedTime &#x3D; 120</span><br><span class="line"></span><br><span class="line">deleteWhen &#x3D; 04</span><br><span class="line"></span><br><span class="line">waitTimeMillsInSendQueue &#x3D; 200</span><br><span class="line"></span><br><span class="line">commercialTransCount &#x3D; 1</span><br><span class="line"></span><br><span class="line">osPageCacheBusyTimeOutMills &#x3D; 1000</span><br><span class="line"></span><br><span class="line">abortFile &#x3D; &#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;abort</span><br><span class="line"></span><br><span class="line">maxIndexNum &#x3D; 20000000</span><br><span class="line"></span><br><span class="line">registerBrokerTimeoutMills &#x3D; 6000</span><br><span class="line"></span><br><span class="line">messageIndexSafe &#x3D; false</span><br><span class="line"></span><br><span class="line">putMsgIndexHightWater &#x3D; 600000</span><br><span class="line"></span><br><span class="line">listenPort &#x3D; 10911</span><br><span class="line"></span><br><span class="line">serverWorkerThreads &#x3D; 8</span><br><span class="line"></span><br><span class="line">clientSocketSndBufSize &#x3D; 131072</span><br><span class="line"></span><br><span class="line">traceOn &#x3D; true</span><br><span class="line"></span><br><span class="line">maxHashSlotNum &#x3D; 5000000</span><br><span class="line"></span><br><span class="line">brokerRole &#x3D; ASYNC_MASTER</span><br><span class="line"></span><br><span class="line">storePathIndex &#x3D; &#x2F;data&#x2F;rocketmq&#x2F;store&#x2F;index</span><br><span class="line"></span><br><span class="line">rocketmqHome &#x3D; &#x2F;home&#x2F;baseuser&#x2F;rocketmq</span><br><span class="line"></span><br><span class="line">useReentrantLockWhenPutMessage &#x3D; false</span><br><span class="line"></span><br><span class="line">haHousekeepingInterval &#x3D; 20000</span><br><span class="line"></span><br><span class="line">brokerPermission &#x3D; 6</span><br><span class="line"></span><br><span class="line">maxTransferCountOnMessageInMemory &#x3D; 1000</span><br><span class="line"></span><br><span class="line">useEpollNativeSelector &#x3D; false</span><br><span class="line"></span><br><span class="line">haSlaveFallbehindMax &#x3D; 268435456</span><br><span class="line"></span><br><span class="line">haTransferBatchSize &#x3D; 32768</span><br><span class="line"></span><br><span class="line">messageStorePlugIn &#x3D;</span><br><span class="line"></span><br><span class="line">pullThreadPoolQueueCapacity &#x3D; 100000</span><br><span class="line"></span><br><span class="line">brokerClusterName &#x3D; ZmsClusterB</span><br><span class="line"></span><br><span class="line">destroyMapedFileIntervalForcibly &#x3D; 120000</span><br><span class="line"></span><br><span class="line">mapedFileSizeCommitLog &#x3D; 1073741824</span><br><span class="line"></span><br><span class="line">commercialBigCount &#x3D; 1</span><br><span class="line"></span><br><span class="line">flushLeastPagesWhenWarmMapedFile &#x3D; 4096</span><br><span class="line"></span><br><span class="line">sendMessageThreadPoolNums &#x3D; 1</span><br><span class="line"></span><br><span class="line">flushIntervalCommitLog &#x3D; 500</span><br></pre></td></tr></table></figure>

<a id="more"></a>



<h1 id="发送消息到broker"><a href="#发送消息到broker" class="headerlink" title="发送消息到broker"></a>发送消息到broker</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin sendMsgStatus -b 192.168.1.x:10911 -n 192.168.1.x:9876</span><br></pre></td></tr></table></figure>



<h1 id="更新broker信息"><a href="#更新broker信息" class="headerlink" title="更新broker信息"></a>更新broker信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin updateBrokerConfig -b 192.168.1.x:10911 -n 192.168.1.x:9876 -k key -v value</span><br></pre></td></tr></table></figure></div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ6# RocketMQ NameSrv命令</title>
    <url>/posts/7ee60e46/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="获取namesrv配置"><a href="#获取namesrv配置" class="headerlink" title="获取namesrv配置"></a>获取namesrv配置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[baseuser@HZPL00xxxx rocketmq]$ sh bin&#x2F;mqadmin getNamesrvConfig -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;192.168.1.x:9876&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">serverChannelMaxIdleTimeSeconds &#x3D; 120</span><br><span class="line"></span><br><span class="line">listenPort &#x3D; 9876</span><br><span class="line"></span><br><span class="line">serverCallbackExecutorThreads &#x3D; 0</span><br><span class="line"></span><br><span class="line">serverAsyncSemaphoreValue &#x3D; 64</span><br><span class="line"></span><br><span class="line">serverSocketSndBufSize &#x3D; 4096</span><br><span class="line"></span><br><span class="line">rocketmqHome &#x3D; &#x2F;home&#x2F;baseuser&#x2F;rocketmq</span><br><span class="line"></span><br><span class="line">clusterTest &#x3D; false</span><br><span class="line"></span><br><span class="line">serverSelectorThreads &#x3D; 3</span><br><span class="line"></span><br><span class="line">useEpollNativeSelector &#x3D; false</span><br><span class="line"></span><br><span class="line">orderMessageEnable &#x3D; false</span><br><span class="line"></span><br><span class="line">serverPooledByteBufAllocatorEnable &#x3D; true</span><br><span class="line"></span><br><span class="line">kvConfigPath &#x3D; &#x2F;home&#x2F;baseuser&#x2F;namesrv&#x2F;kvConfig.json</span><br><span class="line"></span><br><span class="line">serverWorkerThreads &#x3D; 8</span><br><span class="line"></span><br><span class="line">serverSocketRcvBufSize &#x3D; 4096</span><br><span class="line"></span><br><span class="line">productEnvName &#x3D; center</span><br><span class="line"></span><br><span class="line">serverOnewaySemaphoreValue &#x3D; 256</span><br><span class="line"></span><br><span class="line">configStorePath &#x3D; &#x2F;home&#x2F;baseuser&#x2F;namesrv&#x2F;namesrv.properties</span><br></pre></td></tr></table></figure>

<h1 id="删除nameSrv配置"><a href="#删除nameSrv配置" class="headerlink" title="删除nameSrv配置"></a>删除nameSrv配置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqadmin deleteKvConfig -n 192.168.1.x:9876 -s namesapce -k key</span><br><span class="line"></span><br><span class="line">Delete KV config.</span><br><span class="line"></span><br><span class="line">-s set the namespace</span><br><span class="line"></span><br><span class="line">-k key set the key name</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="更新了nameSrv配置"><a href="#更新了nameSrv配置" class="headerlink" title="更新了nameSrv配置"></a>更新了nameSrv配置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqadmin updateKvConfig -n 192.168.1.x:9876 -s namesapce -k key</span><br><span class="line"></span><br><span class="line">update KV config.</span><br><span class="line"></span><br><span class="line">-s set the namespace</span><br><span class="line"></span><br><span class="line">-k key set the key name</span><br><span class="line"></span><br><span class="line">-v value set the key value</span><br></pre></td></tr></table></figure>



<h1 id="更新nameSrv配置"><a href="#更新nameSrv配置" class="headerlink" title="更新nameSrv配置"></a>更新nameSrv配置</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqadmin updateNamesrvConfig -n 192.168.1.x:9876 -s namesapce -k key</span><br><span class="line"></span><br><span class="line">update KV config.</span><br><span class="line"></span><br><span class="line">-k key set the key name</span><br><span class="line"></span><br><span class="line">-v value set the key value</span><br></pre></td></tr></table></figure>



<h1 id="取消Broker写权限"><a href="#取消Broker写权限" class="headerlink" title="取消Broker写权限"></a>取消Broker写权限</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqadmin wipeWritePerm -n 192.168.1.x:9876 -b brokerAddr</span><br><span class="line"></span><br><span class="line">Wipe write perm of broker in all name server</span><br><span class="line"></span><br><span class="line">-b brokerName</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ7# RocketMQ Message相关命令</title>
    <url>/posts/40c12a8c/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="发送测试消息"><a href="#发送测试消息" class="headerlink" title="发送测试消息"></a>发送测试消息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin checkMsgSendRT -n 192.168.x.x:9876 -t topic_online_test -s 1024</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0Broker Name           QID #Send Result      RTbroker-a             0   true          314broker-a             1   true          0broker-a             2   true          0</span><br><span class="line"></span><br><span class="line">broker-a             3   true          0</span><br><span class="line"></span><br><span class="line">broker-b             0   true          2</span><br><span class="line"></span><br><span class="line">broker-b             1   true          1</span><br><span class="line"></span><br><span class="line">broker-b             2   true          1</span><br><span class="line"></span><br><span class="line">broker-b             3   true          0</span><br><span class="line"></span><br><span class="line">broker-a             0   true          1</span><br><span class="line"></span><br><span class="line">broker-a             1   true          0</span><br><span class="line"></span><br><span class="line">broker-a             2   true          0</span><br><span class="line"></span><br><span class="line">broker-a             3   true          1</span><br><span class="line"></span><br><span class="line">broker-b             0   true          4</span><br><span class="line"></span><br><span class="line">-t topic topic name</span><br><span class="line"></span><br><span class="line">-a amount message amout | default 100</span><br><span class="line"></span><br><span class="line">-s size message size | default 128 Byte</span><br></pre></td></tr></table></figure>



<h1 id="print-message-by-queue"><a href="#print-message-by-queue" class="headerlink" title="print message by queue"></a>print message by queue</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin printMsgByQueue -n 192.168.1.x:9876 -b 192.168.1.x -i 0</span><br></pre></td></tr></table></figure>





<h1 id="打印topic中的信息"><a href="#打印topic中的信息" class="headerlink" title="打印topic中的信息"></a>打印topic中的信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin printMsg -n 192.168.1.x:9876 -t SCANRECORD</span><br><span class="line"></span><br><span class="line">&quot;t&quot;, &quot;topic&quot;, true, &quot;topic name&quot;</span><br><span class="line"></span><br><span class="line">&quot;c&quot;, &quot;charsetName &quot;, true, &quot;CharsetName(eg: UTF-8,GBK)&quot;</span><br><span class="line"></span><br><span class="line">&quot;s&quot;, &quot;subExpression &quot;, true, &quot;Subscribe Expression(eg: TagA || TagB)&quot;</span><br><span class="line"></span><br><span class="line">&quot;b&quot;, &quot;beginTimestamp &quot;, true,  Begin timestamp[currentTimeMillis|yyyy-MM-dd#HH:mm:ss:SSS]</span><br><span class="line"></span><br><span class="line">&quot;e&quot;, &quot;endTimestamp &quot;, true, End timestamp[currentTimeMillis|yyyy-MM-dd#HH:mm:ss:SSS]</span><br><span class="line"></span><br><span class="line">&quot;d&quot;, &quot;printBody &quot;, true,&quot;print body&quot;</span><br><span class="line"></span><br><span class="line">MSGID: C0A81F8166832F2C9B1953831616FB45 MessageExt [queueId&#x3D;20, storeSize&#x3D;686, queueOffset&#x3D;35052080, sysFlag&#x3D;0, bornTimestamp&#x3D;1539724299798, bornHost&#x3D;&#x2F;192.168.x.x:29781, storeTimestamp&#x3D;1539724299179, storeHost&#x3D;&#x2F;192.168.x.x:10911, msgId&#x3D;C0A801B400002A9F000005F308F9B3A5, commitLogOffset&#x3D;6541385773989, bodyCRC&#x3D;1167936923, reconsumeTimes&#x3D;0, preparedTransactionOffset&#x3D;0, toString()&#x3D;Message [topic&#x3D;SCANRECORD, flag&#x3D;0, properties&#x3D;&#123;MIN_OFFSET&#x3D;35046369, MAX_OFFSET&#x3D;40298522, KEYS&#x3D;1dd04932-b7d9-43ee-8b31-39d16dd043d4, UNIQ_KEY&#x3D;C0A81F8166832F2C9B1953831616FB45, WAIT&#x3D;true, TAGS&#x3D;2&#125;, body&#x3D;484]] BODY: &#123;&quot;billCode&quot;:&quot;640010206680&quot;,&quot;blReturnBillId&quot;:0,&quot;blUntreadPieceId&quot;:0,&quot;clazz&quot;:&quot;2&quot;,&quot;dataFrom&quot;:&quot;2&quot;,&quot;dispatchId&quot;:0,&quot;ownerBagNo&quot;:&quot;3783585805&quot;,&quot;pdaCode&quot;:&quot;S50117101164&quot;,&quot;piece&quot;:1,&quot;preOrNexStaId&quot;:14761,&quot;preOrNextStation&quot;:&quot;\u6F6E\u6C55\u4E2D\u5FC3&quot;,&quot;prepProvinceId&quot;:440000,&quot;registerDate&quot;:1539724298000,&quot;scanDate&quot;:1539724241000,&quot;scanMan&quot;:&quot;\u9648\u4E9A\u5973&quot;,&quot;scanManCode&quot;:&quot;020019.0865&quot;,&quot;scanProvinceId&quot;:440000,&quot;scanSite&quot;:&quot;\u5E7F\u5DDE\u5E7F\u56ED&quot;,&quot;scanSiteId&quot;:1051037,&quot;scanType&quot;:&quot;\u53D1\u4EF6&quot;&#125;</span><br></pre></td></tr></table></figure>



<h1 id="通过messageId查询消息"><a href="#通过messageId查询消息" class="headerlink" title="通过messageId查询消息"></a>通过messageId查询消息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin queryMsgById -n 192.168.x.x:9876 -i C0A801B400002A9F000005F308F9B3A5</span><br><span class="line"></span><br><span class="line">&quot;i&quot;, &quot;msgId&quot;, true, &quot;Message Id&quot;</span><br><span class="line"></span><br><span class="line">&quot;consumerGroup&quot;, true, &quot;consumer group name&quot;</span><br><span class="line"></span><br><span class="line">&quot;clientId&quot;, true, &quot;The consumer&#39;s client id&quot;</span><br><span class="line"></span><br><span class="line">&quot;sendMessage&quot;, true, &quot;resend message&quot;</span><br><span class="line"></span><br><span class="line">&quot;unitName&quot;, true, &quot;unit name&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin queryMsgById -n 192.168.x.x:9876 -i C0A801B400002A9F000005F308F9B3A5</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">OffsetID:      C0A801B400002A9F000005F308F9B3A5</span><br><span class="line"></span><br><span class="line">OffsetID:      C0A801B400002A9F000005F308F9B3A5</span><br><span class="line"></span><br><span class="line">Topic:        SCANRECORD</span><br><span class="line"></span><br><span class="line">Tags:        [2]</span><br><span class="line"></span><br><span class="line">Keys:        [1dd04932-b7d9-43ee-8b31-39d16dd043d4]</span><br><span class="line"></span><br><span class="line">Queue ID:      20</span><br><span class="line"></span><br><span class="line">Queue Offset:    35052080</span><br><span class="line"></span><br><span class="line">CommitLog Offset:  6541385773989</span><br><span class="line"></span><br><span class="line">Reconsume Times:   0</span><br><span class="line"></span><br><span class="line">Born Timestamp:   2018-10-17 05:11:39,798</span><br><span class="line"></span><br><span class="line">Store Timestamp:   2018-10-17 05:11:39,179</span><br><span class="line"></span><br><span class="line">Born Host:      192.168.31.129:29781</span><br><span class="line"></span><br><span class="line">Store Host:     192.168.1.180:10911</span><br><span class="line"></span><br><span class="line">System Flag:     0</span><br><span class="line"></span><br><span class="line">Properties:     &#123;KEYS&#x3D;1dd04932-b7d9-43ee-8b31-39d16dd043d4, UNIQ_KEY&#x3D;C0A81F8166832F2C9B1953831616FB45, WAIT&#x3D;true, TAGS&#x3D;2&#125;</span><br><span class="line"></span><br><span class="line">Message Body Path:  &#x2F;tmp&#x2F;rocketmq&#x2F;msgbodys&#x2F;C0A81F8166832F2C9B1953831616FB45</span><br><span class="line"></span><br><span class="line">MessageTrack [consumerGroup&#x3D;ZtoSignGroup, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;newOpenPartnerDeadlineJob, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;smartidivision-scanrecord-dis, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;PanguRecordGroup, trackType&#x3D;CONSUMED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;code-send-consumer, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;shenZhouOneSiteKpiConsumer, trackType&#x3D;CONSUMED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;SortComplementConsumer, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;tf_wonder_waybill_center_scanrecord, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;dpmComScanRecordConsumer, trackType&#x3D;UNKNOWN, exceptionDesc&#x3D;org.apache.rocketmq.client.exception.MQClientException: CODE: 17 DESC: No topic route info in name server for the topic: %RETRY%dpmComScanRecordConsumer</span><br><span class="line"></span><br><span class="line">See [http:&#x2F;&#x2F;rocketmq.apache.org&#x2F;docs&#x2F;faq&#x2F;](http:&#x2F;&#x2F;rocketmq.apache.org&#x2F;docs&#x2F;faq&#x2F;) for further details., org.apache.rocketmq.client.impl.MQClientAPIImpl.getTopicRouteInfoFromNameServer(MQClientAPIImpl.java:1212)]MessageTrack</span><br></pre></td></tr></table></figure>



<h1 id="根据key查询存储消息"><a href="#根据key查询存储消息" class="headerlink" title="根据key查询存储消息"></a>根据key查询存储消息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin queryMsgByKey -n 192.168.x.x:9876 -t SCANRECORD -k 1dd04932-b7d9-43ee-8b31-39d16dd043d4</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Message ID                    QID                 Offset</span><br><span class="line"></span><br><span class="line">C0A81F8166832F2C9B1953831616FB45           20                 35052080</span><br></pre></td></tr></table></figure>



<h1 id="根据offset查询储存消息"><a href="#根据offset查询储存消息" class="headerlink" title="根据offset查询储存消息"></a>根据offset查询储存消息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin queryMsgByOffset -n 192.168.x.x:9876 -t SCANRECORD -b broker-a -i 20 -o 35052080</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">OffsetID:      C0A801B400002A9F000005F308F9B3A5</span><br><span class="line"></span><br><span class="line">OffsetID:      C0A801B400002A9F000005F308F9B3A5</span><br><span class="line"></span><br><span class="line">Topic:        SCANRECORD</span><br><span class="line"></span><br><span class="line">Tags:        [2]</span><br><span class="line"></span><br><span class="line">Keys:        [1dd04932-b7d9-43ee-8b31-39d16dd043d4]</span><br><span class="line"></span><br><span class="line">Queue ID:      20</span><br><span class="line"></span><br><span class="line">Queue Offset:    35052080</span><br><span class="line"></span><br><span class="line">CommitLog Offset:  6541385773989</span><br><span class="line"></span><br><span class="line">Reconsume Times:   0</span><br><span class="line"></span><br><span class="line">Born Timestamp:   2018-10-17 05:11:39,798</span><br><span class="line"></span><br><span class="line">Store Timestamp:   2018-10-17 05:11:39,179</span><br><span class="line"></span><br><span class="line">Born Host:      192.168.31.129:29781</span><br><span class="line"></span><br><span class="line">Store Host:     192.168.1.180:10911</span><br><span class="line"></span><br><span class="line">System Flag:     0</span><br><span class="line"></span><br><span class="line">Properties:     &#123;MIN_OFFSET&#x3D;35046369, MAX_OFFSET&#x3D;40342481, KEYS&#x3D;1dd04932-b7d9-43ee-8b31-39d16dd043d4, UNIQ_KEY&#x3D;C0A81F8166832F2C9B1953831616FB45, WAIT&#x3D;true, TAGS&#x3D;2&#125;</span><br><span class="line"></span><br><span class="line">Message Body Path:  &#x2F;tmp&#x2F;rocketmq&#x2F;msgbodys&#x2F;C0A81F8166832F2C9B1953831616FB45</span><br><span class="line"></span><br><span class="line">MessageTrack [consumerGroup&#x3D;ZtoSignGroup, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;newOpenPartnerDeadlineJob, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;smartidivision-scanrecord-dis, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;PanguRecordGroup, trackType&#x3D;CONSUMED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;code-send-consumer, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;shenZhouOneSiteKpiConsumer, trackType&#x3D;CONSUMED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;SortComplementConsumer, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;tf_wonder_waybill_center_scanrecord, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;dpmComScanRecordConsumer, trackType&#x3D;UNKNOWN, exceptionDesc&#x3D;org.apache.rocketmq.client.exception.MQClientException: CODE: 17 DESC: No topic route info in name server for the topic: %RETRY%dpmComScanRecordConsumer</span><br><span class="line"></span><br><span class="line">See [http:&#x2F;&#x2F;rocketmq.apache.org&#x2F;docs&#x2F;faq&#x2F;](http:&#x2F;&#x2F;rocketmq.apache.org&#x2F;docs&#x2F;faq&#x2F;) for further details., org.apache.rocketmq.client.impl.MQClientAPIImpl.getTopicRouteInfoFromNameServer(MQClientAPIImpl.java:1212)]MessageTrack [</span><br><span class="line"></span><br><span class="line">&quot;t&quot;, &quot;topic&quot;, true, &quot;topic name&quot;</span><br><span class="line"></span><br><span class="line">&quot;b&quot;, &quot;brokerName&quot;, true, &quot;Broker Name&quot;</span><br><span class="line"></span><br><span class="line">&quot;i&quot;, &quot;queueId&quot;, true, &quot;Queue Id&quot;</span><br><span class="line"></span><br><span class="line">&quot;o&quot;, &quot;offset&quot;, true, &quot;Queue Offset&quot;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h1 id="通过UniqueKey查询消息内容"><a href="#通过UniqueKey查询消息内容" class="headerlink" title="通过UniqueKey查询消息内容"></a>通过UniqueKey查询消息内容</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin queryMsgByUniqueKey -n 192.168.x.x:9876 -t SCANRECORD -i C0A801B400002A9F000005F308F9B3A5</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Topic:        SCANRECORD</span><br><span class="line"></span><br><span class="line">Tags:        [2]</span><br><span class="line"></span><br><span class="line">Keys:        [1dd04932-b7d9-43ee-8b31-39d16dd043d4]</span><br><span class="line"></span><br><span class="line">Queue ID:      20</span><br><span class="line"></span><br><span class="line">Queue Offset:    35052080</span><br><span class="line"></span><br><span class="line">CommitLog Offset:  6541385773989</span><br><span class="line"></span><br><span class="line">Reconsume Times:   0</span><br><span class="line"></span><br><span class="line">Born Timestamp:   2018-10-17 05:11:39,798</span><br><span class="line"></span><br><span class="line">Store Timestamp:   2018-10-17 05:11:39,179</span><br><span class="line"></span><br><span class="line">Born Host:      192.168.31.129:29781</span><br><span class="line"></span><br><span class="line">Store Host:     192.168.1.180:10911</span><br><span class="line"></span><br><span class="line">System Flag:     0</span><br><span class="line"></span><br><span class="line">Properties:     &#123;KEYS&#x3D;1dd04932-b7d9-43ee-8b31-39d16dd043d4, UNIQ_KEY&#x3D;C0A81F8166832F2C9B1953831616FB45, WAIT&#x3D;true, TAGS&#x3D;2&#125;</span><br><span class="line"></span><br><span class="line">Message Body Path:  &#x2F;tmp&#x2F;rocketmq&#x2F;msgbodys&#x2F;C0A81F8166832F2C9B1953831616FB45</span><br><span class="line"></span><br><span class="line">MessageTrack [consumerGroup&#x3D;ZtoSignGroup, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;newOpenPartnerDeadlineJob, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;smartidivision-scanrecord-dis, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;PanguRecordGroup, trackType&#x3D;CONSUMED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;code-send-consumer, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;shenZhouOneSiteKpiConsumer, trackType&#x3D;CONSUMED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;SortComplementConsumer, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;tf_wonder_waybill_center_scanrecord, trackType&#x3D;CONSUMED_BUT_FILTERED, exceptionDesc&#x3D;null]MessageTrack [consumerGroup&#x3D;dpmComScanRecordConsumer, trackType&#x3D;UNKNOWN, exceptionDesc&#x3D;org.apache.rocketmq.client.exception.MQClientException: CODE: 17 DESC: No topic route info in name server for the topic: %RETRY%dpmComScanRecordConsumer</span><br><span class="line"></span><br><span class="line">See [http:&#x2F;&#x2F;rocketmq.apache.org&#x2F;docs&#x2F;faq&#x2F;](http:&#x2F;&#x2F;rocketmq.apache.org&#x2F;docs&#x2F;faq&#x2F;) for further details., org.apache.rocketmq.client.impl.MQClientAPIImpl.getTopicRouteInfoFromNameServer(MQClientAPIImpl.java:1212)]MessageTrack </span><br><span class="line"></span><br><span class="line">&quot;i&quot;, &quot;msgId&quot;, true, &quot;Message Id&quot;</span><br><span class="line"></span><br><span class="line">&quot;g&quot;, &quot;consumerGroup&quot;, true, &quot;consumer group name&quot;</span><br><span class="line"></span><br><span class="line">&quot;d&quot;, &quot;clientId&quot;, true, &quot;The consumer&#39;s client id&quot;</span><br><span class="line"></span><br><span class="line">&quot;t&quot;, &quot;topic&quot;, true, &quot;The topic of msg&quot;</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ8# RocketMQ Topic相关命令</title>
    <url>/posts/48072e7/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="分配MQ"><a href="#分配MQ" class="headerlink" title="分配MQ"></a>分配MQ</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin allocateMQ -n localhost:9876 -t tst-topic -i ipList</span><br><span class="line"></span><br><span class="line">ipList 以逗号分隔</span><br></pre></td></tr></table></figure>



<h1 id="删除topic"><a href="#删除topic" class="headerlink" title="删除topic"></a>删除topic</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin deleteTopic -n localhost:9876 -t zto-example -c DefultCluster</span><br></pre></td></tr></table></figure>



<h1 id="获取topic的cluster"><a href="#获取topic的cluster" class="headerlink" title="获取topic的cluster"></a>获取topic的cluster</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin topicClusterList -n 192.168.1.x:9876 -t SCANRECORD</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">ZmsClusterB</span><br></pre></td></tr></table></figure>



<h1 id="查看Topic列表信息"><a href="#查看Topic列表信息" class="headerlink" title="查看Topic列表信息"></a>查看Topic列表信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin topicList -n localhost:9876</span><br></pre></td></tr></table></figure>



<h1 id="查看Topic路由信息"><a href="#查看Topic路由信息" class="headerlink" title="查看Topic路由信息"></a>查看Topic路由信息</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin topicRoute -n 192.168.1.x:9876 -t SCANRECORD</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerDatas&quot;:[</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerAddrs&quot;:&#123;0:&quot;192.168.1.x:10911&quot;,1:&quot;192.168.1.x:10920&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;brokerName&quot;:&quot;broker-d&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerAddrs&quot;:&#123;0:&quot;192.168.1.x:10911&quot;,1:&quot;192.168.1.x:10920&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;brokerName&quot;:&quot;broker-b&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerAddrs&quot;:&#123;0:&quot;192.168.1.x:10911&quot;,1:&quot;192.168.1.x:10915&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;brokerName&quot;:&quot;broker-c&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerAddrs&quot;:&#123;0:&quot;192.168.1.x:10911&quot;,1:&quot;192.168.1.x:10915&quot;</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&quot;brokerName&quot;:&quot;broker-a&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">&quot;filterServerTable&quot;:&#123;&#125;,</span><br><span class="line"></span><br><span class="line">&quot;queueDatas&quot;:[</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerName&quot;:&quot;broker-b&quot;,</span><br><span class="line"></span><br><span class="line">&quot;perm&quot;:6,</span><br><span class="line"></span><br><span class="line">&quot;readQueueNums&quot;:64,</span><br><span class="line"></span><br><span class="line">&quot;topicSynFlag&quot;:0,</span><br><span class="line"></span><br><span class="line">&quot;writeQueueNums&quot;:64</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerName&quot;:&quot;broker-a&quot;,</span><br><span class="line"></span><br><span class="line">&quot;perm&quot;:6,</span><br><span class="line"></span><br><span class="line">&quot;readQueueNums&quot;:64,</span><br><span class="line"></span><br><span class="line">&quot;topicSynFlag&quot;:0,</span><br><span class="line"></span><br><span class="line">&quot;writeQueueNums&quot;:64</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerName&quot;:&quot;broker-c&quot;,</span><br><span class="line"></span><br><span class="line">&quot;perm&quot;:6,</span><br><span class="line"></span><br><span class="line">&quot;readQueueNums&quot;:64,</span><br><span class="line"></span><br><span class="line">&quot;topicSynFlag&quot;:0,</span><br><span class="line"></span><br><span class="line">&quot;writeQueueNums&quot;:64</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&quot;brokerName&quot;:&quot;broker-d&quot;,</span><br><span class="line"></span><br><span class="line">&quot;perm&quot;:6,</span><br><span class="line"></span><br><span class="line">&quot;readQueueNums&quot;:64,</span><br><span class="line"></span><br><span class="line">&quot;topicSynFlag&quot;:0,</span><br><span class="line"></span><br><span class="line">&quot;writeQueueNums&quot;:64</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="查看topic状态"><a href="#查看topic状态" class="headerlink" title="查看topic状态"></a>查看topic状态</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin topicStatus -n 192.168.1.174:9876 -t SCANRECORD</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Broker Name QID Min Offset Max Offset Last Updated</span><br><span class="line"></span><br><span class="line">broker-a 0 34757063 39718709 2018-10-22 13:54:32,526</span><br><span class="line"></span><br><span class="line">broker-a 1 34760194 39722786 2018-10-22 13:54:32,149</span><br><span class="line"></span><br><span class="line">broker-a 2 34765030 39734966 2018-10-22 13:54:32,537</span><br><span class="line"></span><br><span class="line">broker-a 3 34775398 39758820 2018-10-22 13:54:32,507</span><br><span class="line"></span><br><span class="line">broker-a 4 34804472 39800334 2018-10-22 13:54:32,511</span><br><span class="line"></span><br><span class="line">broker-a 5 34835232 39854584 2018-10-22 13:54:32,528</span><br><span class="line"></span><br><span class="line">broker-a 6 34863554 39910095 2018-10-22 13:54:32,528</span><br></pre></td></tr></table></figure>



<h1 id="更新orderConf"><a href="#更新orderConf" class="headerlink" title="更新orderConf"></a>更新orderConf</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqadmin updateOrderConf -t SCANRECORD -m put -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">-m option type [eg. put|get|delete</span><br></pre></td></tr></table></figure>



<h1 id="更改Topic权限"><a href="#更改Topic权限" class="headerlink" title="更改Topic权限"></a>更改Topic权限</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin updateTopicPerm -t SCANRECORD -p put -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">-p : set topic&#39;s permission(2|4|6), intro[2:W; 4:R; 6:RW]</span><br><span class="line"></span><br><span class="line">bin&#x2F;mqadmin updateTopicPerm -c ZmsClusterB -t %DLQ%starunion-freight -p 6 -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">update topic perm from 2 to 6 in 192.168.1.x:10911 success.</span><br><span class="line"></span><br><span class="line">update topic perm from 2 to 6 in 192.168.1.x:10911 success.</span><br><span class="line"></span><br><span class="line">update topic perm from 2 to 6 in 192.168.1.x:10911 success.</span><br><span class="line"></span><br><span class="line">update topic perm from 2 to 6 in 192.168.1.x:10911 success.</span><br></pre></td></tr></table></figure>





<a id="more"></a>



<h1 id="创建-修改Topic"><a href="#创建-修改Topic" class="headerlink" title="创建/修改Topic"></a>创建/修改Topic</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh bin&#x2F;mqadmin updateTopic -c DefaultCluster -n localhost:9876 -t threezto-test -r 12 -w 12</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">create topic to x.x.x.40:10911 success.</span><br><span class="line"></span><br><span class="line">TopicConfig [topicName&#x3D;threezto-test, readQueueNums&#x3D;12, writeQueueNums&#x3D;12, perm&#x3D;RW-, topicFilterType&#x3D;SINGLE_TAG, topicSysFlag&#x3D;0, order&#x3D;false]</span><br><span class="line"></span><br><span class="line">-b brokerAddr create topic to which broker</span><br><span class="line"></span><br><span class="line">-c clusterName create topic to which cluster</span><br><span class="line"></span><br><span class="line">-t topic topic name</span><br><span class="line"></span><br><span class="line">-r readQueueNums set read queue nums</span><br><span class="line"></span><br><span class="line">-w writeQueueNums set write queue nums</span><br><span class="line"></span><br><span class="line">-p perm set topic&#39;s permission(2|4|6), intro[2:W 4:R; 6:RW]</span><br><span class="line"></span><br><span class="line">-o order set topic&#39;s order(true|false</span><br><span class="line"></span><br><span class="line">-u unit is unit topic (true|false</span><br><span class="line"></span><br><span class="line">-s hasUnitSub has unit sub (true|false</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ9# RocketMQ Offset 相关命令</title>
    <url>/posts/5c6eeeec/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="克隆消费组的offset（同一个集群）"><a href="#克隆消费组的offset（同一个集群）" class="headerlink" title="克隆消费组的offset（同一个集群）"></a>克隆消费组的offset（同一个集群）</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin cloneGroupOffset -n 192.168.1.x:9876 -s SCANRECORD_GROUP -d my-tst-cloneoffset -t SCANRECORD</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">clone group offset success. srcGroup[SCANRECORD_GROUP], destGroup&#x3D;[my-tst-cloneoffset], topic[SCANRECORD][baseuser@HZPL001180 rocketmq]$</span><br></pre></td></tr></table></figure>



<h1 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin statsAll -t SCANRECORD -n 192.168.1.x:9876</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Topic Consumer Group Accumulation InTPS OutTPS InMsg24Hour OutMsg24Hour</span><br><span class="line"></span><br><span class="line">SCANRECORD ZtoSignGroup 2290 3063.95 522.72 233588408 29106863</span><br><span class="line"></span><br><span class="line">SCANRECORD newOpenPartnerDeadlineJob 2641 3063.95 522.72 233588408 29052057</span><br><span class="line"></span><br><span class="line">SCANRECORD smartidivision-scanrecord-dis 3110 3063.95 399.03 233588408 30052791</span><br><span class="line"></span><br><span class="line">SCANRECORD PanguRecordGroup 574 3063.95 2041.17 233588408 174462813</span><br><span class="line"></span><br><span class="line">SCANRECORD code-send-consumer 881 3063.95 1162.63 233588408 60072932</span><br><span class="line"></span><br><span class="line">SCANRECORD shenZhouOneSiteKpiConsumer 669 3063.95 1798.57 233588408 137543100</span><br><span class="line"></span><br><span class="line">SCANRECORD SortComplementConsumer 2746 3063.95 522.72 233588408 11466488</span><br><span class="line"></span><br><span class="line">SCANRECORD **my-tst-cloneoffset** 0 3063.95 0.00 233588408 0</span><br><span class="line"></span><br><span class="line">SCANRECORD tf_wonder_waybill_center_scanrec 2516 3063.95 522.72 233588408 29056664</span><br><span class="line"></span><br><span class="line">SCANRECORD dpmComScanRecordConsumer 0 3063.95 0.00 233588408 0</span><br><span class="line"></span><br><span class="line">SCANRECORD zms_syncer_SCANRECORD 286 3063.95 3063.73 233588408 233588419</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="根据时间重置消费位点"><a href="#根据时间重置消费位点" class="headerlink" title="根据时间重置消费位点"></a>根据时间重置消费位点</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin&#x2F;mqadmin resetOffsetByTime -n 192.168.1.x:9876 -g ReceiveOrderGroupNew -t SCANRECORD -s now</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">rollback consumer offset by specified group[ReceiveOrderGroupNew], topic[SCANRECORD], force[true], timestamp(string)[now], timestamp(long)[1540196941761]</span><br><span class="line"></span><br><span class="line">brokerName queueId offset</span><br><span class="line"></span><br><span class="line">broker-a 20 40375806</span><br><span class="line"></span><br><span class="line">broker-b 55 40209057</span><br><span class="line"></span><br><span class="line">broker-c 24 40151853</span><br><span class="line"></span><br><span class="line">broker-b 22 40284014</span><br><span class="line"></span><br><span class="line">broker-a 53 40321569</span><br><span class="line"></span><br><span class="line">broker-d 59 39980239</span><br><span class="line"></span><br><span class="line">bin&#x2F;mqadmin resetOffsetByTime -n 192.168.1.x:9876 -g ReceiveOrderGroupNew -t SCANRECORD -s 1540196941761</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option PermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;128m; support was removed in 8.0</span><br><span class="line"></span><br><span class="line">rollback consumer offset by specified group[ReceiveOrderGroupNew], topic[SCANRECORD], force[true], timestamp(string)[1540196941761], timestamp(long)[1540196941761]</span><br><span class="line"></span><br><span class="line">brokerName queueId offset</span><br><span class="line"></span><br><span class="line">broker-a 20 40375806</span><br><span class="line"></span><br><span class="line">broker-b 55 40209057</span><br><span class="line"></span><br><span class="line">broker-c 24 40151853</span><br><span class="line"></span><br><span class="line">broker-b 22 40284014</span><br><span class="line"></span><br><span class="line">&quot;g&quot;, &quot;group&quot;, true, &quot;set the consumer group&quot;</span><br><span class="line"></span><br><span class="line">&quot;s&quot;, &quot;timestamp&quot;, true, &quot;set the timestamp[now|currentTimeMillis|yyyy-MM-dd#HH:mm:ss:SSS]&quot;</span><br><span class="line"></span><br><span class="line">&quot;f&quot;, &quot;force&quot;, true, &quot;set the force rollback by timestamp switch[true|false]&quot;</span><br><span class="line"></span><br><span class="line">&quot;c&quot;, &quot;cplus&quot;, false, &quot;reset c++ client offset&quot;</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>MQ13# RocketMQ性能测试</title>
    <url>/posts/5d180165/</url>
    <content><![CDATA[<div id="vip-container"><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1.概述</span><br><span class="line"></span><br><span class="line">2.1个线程测试记录</span><br><span class="line"></span><br><span class="line">a.1个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.1个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.1个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.1个线程 消息3K 16个队列</span><br><span class="line"></span><br><span class="line">3.10个线程测试记录</span><br><span class="line"></span><br><span class="line">a.10个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.10个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.10个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.10个线程 消息3K 16个队列</span><br><span class="line"></span><br><span class="line">4.30个线程测试记录</span><br><span class="line"></span><br><span class="line">a.30个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.30个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.30个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.30个线程 消息3K 16个队列</span><br><span class="line"></span><br><span class="line">5.45个线程测试记录</span><br><span class="line"></span><br><span class="line">a.45个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.45个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.45个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.45个线程 消息3K 16个队列</span><br><span class="line"></span><br><span class="line">6.60个线程测试记录</span><br><span class="line"></span><br><span class="line">a.60个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.60个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.60个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.60个线程 消息3K 16个队列</span><br><span class="line"></span><br><span class="line">7.75个线程测试记录</span><br><span class="line"></span><br><span class="line">a.75个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.75个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.75个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.75个线程 消息3K 16个队列</span><br><span class="line"></span><br><span class="line">8.100个线程测试记录</span><br><span class="line"></span><br><span class="line">a.100个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.100个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.100个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.100个线程 消息3K 16个队列</span><br><span class="line"></span><br><span class="line">9.150个线程测试记录</span><br><span class="line"></span><br><span class="line">a.150个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.150个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.150个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.150个线程 消息3K 16个队列</span><br><span class="line"></span><br><span class="line">10.200个线程测试记录</span><br><span class="line"></span><br><span class="line">a.200个线程 消息1K 8个队列</span><br><span class="line"></span><br><span class="line">b.200个线程 消息3K 8个队列</span><br><span class="line"></span><br><span class="line">c.200个线程 消息1K 16个队列</span><br><span class="line"></span><br><span class="line">d.200个线程 消息3K 16个队列</span><br></pre></td></tr></table></figure>



<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>目的：对生产环境RocketMQ集群进行性能测试,该集群4主4从。</p>
<p>过程：线程数1、线程数10、线程数30、线程数60、线程数100、线程数150、线程数200对消息大小为1K、3K；队列为8个、16个分别进行测试。</p>
<p>结果：其中最大TPS为12.6万，最小TPS为3.6万。</p>
<h1 id="1个线程测试记录"><a href="#1个线程测试记录" class="headerlink" title="1个线程测试记录"></a>1个线程测试记录</h1><h3 id="1个线程-消息1K-8个队列"><a href="#1个线程-消息1K-8个队列" class="headerlink" title="1个线程 消息1K 8个队列"></a>1个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 1 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 4281 Max RT: 299 Average RT: 0.233 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4237 Max RT: 299 Average RT: 0.236 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4533 Max RT: 299 Average RT: 0.221 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4404 Max RT: 299 Average RT: 0.227 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4360 Max RT: 299 Average RT: 0.229 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4269 Max RT: 299 Average RT: 0.234 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4319 Max RT: 299 Average RT: 0.231 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="1个线程-消息3K-8个队列"><a href="#1个线程-消息3K-8个队列" class="headerlink" title="1个线程 消息3K 8个队列"></a>1个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 1 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 4120 Max RT: 255 Average RT: 0.242 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4054 Max RT: 255 Average RT: 0.246 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4010 Max RT: 255 Average RT: 0.249 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4125 Max RT: 255 Average RT: 0.242 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4093 Max RT: 255 Average RT: 0.244 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4093 Max RT: 255 Average RT: 0.244 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 3999 Max RT: 255 Average RT: 0.250 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 3957 Max RT: 255 Average RT: 0.253 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>

<h3 id="1个线程-消息1K-16个队列"><a href="#1个线程-消息1K-16个队列" class="headerlink" title="1个线程 消息1K 16个队列"></a>1个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 1 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 5289 Max RT: 225 Average RT: 0.189 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 5252 Max RT: 225 Average RT: 0.190 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 5124 Max RT: 225 Average RT: 0.195 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 5146 Max RT: 225 Average RT: 0.194 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4861 Max RT: 225 Average RT: 0.206 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4998 Max RT: 225 Average RT: 0.200 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 5063 Max RT: 225 Average RT: 0.198 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 5039 Max RT: 225 Average RT: 0.198 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>

<h3 id="1个线程-消息3K-16个队列"><a href="#1个线程-消息3K-16个队列" class="headerlink" title="1个线程 消息3K 16个队列"></a>1个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 1 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 4778 Max RT: 244 Average RT: 0.209 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 5011 Max RT: 244 Average RT: 0.199 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4826 Max RT: 244 Average RT: 0.207 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4762 Max RT: 244 Average RT: 0.210 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4663 Max RT: 244 Average RT: 0.214 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4648 Max RT: 244 Average RT: 0.215 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4778 Max RT: 244 Average RT: 0.209 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4737 Max RT: 244 Average RT: 0.211 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4523 Max RT: 244 Average RT: 0.221 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4544 Max RT: 244 Average RT: 0.220 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4683 Max RT: 244 Average RT: 0.213 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4838 Max RT: 244 Average RT: 0.207 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>





<h1 id="10个线程测试记录"><a href="#10个线程测试记录" class="headerlink" title="10个线程测试记录"></a>10个线程测试记录</h1><h3 id="10个线程-消息1K-8个队列"><a href="#10个线程-消息1K-8个队列" class="headerlink" title="10个线程 消息1K 8个队列"></a>10个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 1 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 4778 Max RT: 244 Average RT: 0.209 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 5011 Max RT: 244 Average RT: 0.199 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4826 Max RT: 244 Average RT: 0.207 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4762 Max RT: 244 Average RT: 0.210 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4663 Max RT: 244 Average RT: 0.214 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4648 Max RT: 244 Average RT: 0.215 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4778 Max RT: 244 Average RT: 0.209 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4737 Max RT: 244 Average RT: 0.211 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4523 Max RT: 244 Average RT: 0.221 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4544 Max RT: 244 Average RT: 0.220 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4683 Max RT: 244 Average RT: 0.213 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 4838 Max RT: 244 Average RT: 0.207 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="10个线程-消息3K-8个队列"><a href="#10个线程-消息3K-8个队列" class="headerlink" title="10个线程 消息3K 8个队列"></a>10个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 10 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 40085 Max RT: 265 Average RT: 0.249 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 37710 Max RT: 265 Average RT: 0.265 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 39305 Max RT: 265 Average RT: 0.254 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 39881 Max RT: 265 Average RT: 0.251 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 38428 Max RT: 265 Average RT: 0.260 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 39280 Max RT: 265 Average RT: 0.255 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 38539 Max RT: 265 Average RT: 0.259 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 40927 Max RT: 265 Average RT: 0.244 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="10个线程-消息1K-16个队列"><a href="#10个线程-消息1K-16个队列" class="headerlink" title="10个线程 消息1K 16个队列"></a>10个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 10 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 41301 Max RT: 243 Average RT: 0.242 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 42365 Max RT: 243 Average RT: 0.236 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 42181 Max RT: 243 Average RT: 0.237 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 42261 Max RT: 243 Average RT: 0.237 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 40831 Max RT: 243 Average RT: 0.245 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 43010 Max RT: 243 Average RT: 0.232 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 41871 Max RT: 243 Average RT: 0.239 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 40970 Max RT: 243 Average RT: 0.244 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="10个线程-消息3K-16个队列"><a href="#10个线程-消息3K-16个队列" class="headerlink" title="10个线程 消息3K 16个队列"></a>10个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 10 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 36245 Max RT: 237 Average RT: 0.276 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 38713 Max RT: 237 Average RT: 0.258 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 36327 Max RT: 237 Average RT: 0.275 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 39005 Max RT: 237 Average RT: 0.256 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 37926 Max RT: 237 Average RT: 0.264 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 38804 Max RT: 237 Average RT: 0.258 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 39976 Max RT: 237 Average RT: 0.250 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h1 id="30个线程测试记录"><a href="#30个线程测试记录" class="headerlink" title="30个线程测试记录"></a>30个线程测试记录</h1><h3 id="30个线程-消息1K-8个队列"><a href="#30个线程-消息1K-8个队列" class="headerlink" title="30个线程 消息1K 8个队列"></a>30个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 30 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 86259 Max RT: 309 Average RT: 0.348 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 85335 Max RT: 309 Average RT: 0.351 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 81850 Max RT: 309 Average RT: 0.366 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 87712 Max RT: 309 Average RT: 0.342 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 89288 Max RT: 309 Average RT: 0.336 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 86732 Max RT: 309 Average RT: 0.346 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="30个线程-消息3K-8个队列"><a href="#30个线程-消息3K-8个队列" class="headerlink" title="30个线程 消息3K 8个队列"></a>30个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 30 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 74085 Max RT: 334 Average RT: 0.405 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 71014 Max RT: 334 Average RT: 0.422 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 77792 Max RT: 334 Average RT: 0.386 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 73913 Max RT: 334 Average RT: 0.406 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 77337 Max RT: 334 Average RT: 0.392 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 72184 Max RT: 334 Average RT: 0.416 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 77271 Max RT: 334 Average RT: 0.388 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 75016 Max RT: 334 Average RT: 0.400 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="30个线程-消息1K-16个队列"><a href="#30个线程-消息1K-16个队列" class="headerlink" title="30个线程 消息1K 16个队列"></a>30个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 30 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 82946 Max RT: 306 Average RT: 0.362 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 86902 Max RT: 306 Average RT: 0.345 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 83157 Max RT: 306 Average RT: 0.365 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 86804 Max RT: 306 Average RT: 0.345 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 87009 Max RT: 306 Average RT: 0.345 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 80219 Max RT: 306 Average RT: 0.374 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="30个线程-消息3K-16个队列"><a href="#30个线程-消息3K-16个队列" class="headerlink" title="30个线程 消息3K 16个队列"></a>30个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 30 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 73864 Max RT: 329 Average RT: 0.403 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 78555 Max RT: 329 Average RT: 0.382 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 75200 Max RT: 329 Average RT: 0.406 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 73925 Max RT: 329 Average RT: 0.406 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 69955 Max RT: 329 Average RT: 0.429 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h1 id="45个线程测试记录"><a href="#45个线程测试记录" class="headerlink" title="45个线程测试记录"></a>45个线程测试记录</h1><h3 id="45个线程-消息1K-8个队列"><a href="#45个线程-消息1K-8个队列" class="headerlink" title="45个线程 消息1K 8个队列"></a>45个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 45 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 91266 Max RT: 2063 Average RT: 0.493 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 87279 Max RT: 2063 Average RT: 0.515 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 92130 Max RT: 2063 Average RT: 0.487 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 95227 Max RT: 2063 Average RT: 0.472 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 96340 Max RT: 2063 Average RT: 0.467 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 84272 Max RT: 2063 Average RT: 0.534 Send Failed: 0 Response Failed: 1</span><br></pre></td></tr></table></figure>



<h3 id="45个线程-消息3K-8个队列"><a href="#45个线程-消息3K-8个队列" class="headerlink" title="45个线程 消息3K 8个队列"></a>45个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 45 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 89334 Max RT: 462 Average RT: 0.503 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 84237 Max RT: 462 Average RT: 0.534 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 86051 Max RT: 462 Average RT: 0.523 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 86475 Max RT: 462 Average RT: 0.520 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 86088 Max RT: 462 Average RT: 0.523 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 90403 Max RT: 462 Average RT: 0.498 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 84229 Max RT: 462 Average RT: 0.534 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="45个线程-消息1K-16个队列"><a href="#45个线程-消息1K-16个队列" class="headerlink" title="45个线程 消息1K 16个队列"></a>45个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 45 -s 1024 -n 192.168.x.:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 91724 Max RT: 604 Average RT: 0.490 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 90414 Max RT: 604 Average RT: 0.498 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 89904 Max RT: 604 Average RT: 0.500 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 100158 Max RT: 604 Average RT: 0.449 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 99658 Max RT: 604 Average RT: 0.451 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 92440 Max RT: 604 Average RT: 0.489 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="45个线程-消息3K-16个队列"><a href="#45个线程-消息3K-16个队列" class="headerlink" title="45个线程 消息3K 16个队列"></a>45个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 30 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 75159 Max RT: 436 Average RT: 0.399 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 75315 Max RT: 436 Average RT: 0.398 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 77297 Max RT: 436 Average RT: 0.388 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 72188 Max RT: 436 Average RT: 0.415 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 77525 Max RT: 436 Average RT: 0.387 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 71535 Max RT: 436 Average RT: 0.422 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<a id="more"></a>



<h1 id="60个线程测试记录"><a href="#60个线程测试记录" class="headerlink" title="60个线程测试记录"></a>60个线程测试记录</h1><h3 id="60个线程-消息1K-8个队列"><a href="#60个线程-消息1K-8个队列" class="headerlink" title="60个线程 消息1K 8个队列"></a>60个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 60 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 110067 Max RT: 369 Average RT: 0.545 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 111395 Max RT: 369 Average RT: 0.538 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 103114 Max RT: 369 Average RT: 0.582 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 107466 Max RT: 369 Average RT: 0.558 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 106655 Max RT: 369 Average RT: 0.562 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 107241 Max RT: 369 Average RT: 0.559 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 110672 Max RT: 369 Average RT: 0.540 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 109037 Max RT: 369 Average RT: 0.552 Send Failed: 0 Response Failed: 1</span><br></pre></td></tr></table></figure>



<h3 id="60个线程-消息3K-8个队列"><a href="#60个线程-消息3K-8个队列" class="headerlink" title="60个线程 消息3K 8个队列"></a>60个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 60 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 92572 Max RT: 583 Average RT: 0.648 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 95163 Max RT: 583 Average RT: 0.640 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 93823 Max RT: 583 Average RT: 0.654 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 97091 Max RT: 583 Average RT: 0.628 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 98205 Max RT: 583 Average RT: 0.628 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 99535 Max RT: 583 Average RT: 0.596 Send Failed: 0 Response Failed: 3</span><br></pre></td></tr></table></figure>



<h3 id="60个线程-消息1K-16个队列"><a href="#60个线程-消息1K-16个队列" class="headerlink" title="60个线程 消息1K 16个队列"></a>60个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 60 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 105229 Max RT: 358 Average RT: 0.578 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 103003 Max RT: 358 Average RT: 0.582 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 95497 Max RT: 358 Average RT: 0.628 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 108878 Max RT: 358 Average RT: 0.551 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 109265 Max RT: 358 Average RT: 0.549 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 105545 Max RT: 358 Average RT: 0.568 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 111667 Max RT: 358 Average RT: 0.537 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="60个线程-消息3K-16个队列"><a href="#60个线程-消息3K-16个队列" class="headerlink" title="60个线程 消息3K 16个队列"></a>60个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 60 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 98899 Max RT: 358 Average RT: 0.606 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 101073 Max RT: 358 Average RT: 0.594 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 97295 Max RT: 358 Average RT: 0.617 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 97923 Max RT: 358 Average RT: 0.609 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 96111 Max RT: 358 Average RT: 0.620 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 93873 Max RT: 358 Average RT: 0.639 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 96466 Max RT: 358 Average RT: 0.622 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 96579 Max RT: 358 Average RT: 0.621 Send Failed: 0 Response Failed: 2</span><br></pre></td></tr></table></figure>



<h1 id="75个线程测试记录"><a href="#75个线程测试记录" class="headerlink" title="75个线程测试记录"></a>75个线程测试记录</h1><h3 id="75个线程-消息1K-8个队列"><a href="#75个线程-消息1K-8个队列" class="headerlink" title="75个线程 消息1K 8个队列"></a>75个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 75 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 108367 Max RT: 384 Average RT: 0.692 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 107516 Max RT: 384 Average RT: 0.701 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 110974 Max RT: 384 Average RT: 0.680 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 109754 Max RT: 384 Average RT: 0.683 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 111917 Max RT: 384 Average RT: 0.670 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 104764 Max RT: 384 Average RT: 0.712 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 112208 Max RT: 384 Average RT: 0.668 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 112707 Max RT: 384 Average RT: 0.665 Send Failed: 0 Response Failed: 1</span><br></pre></td></tr></table></figure>



<h3 id="75个线程-消息3K-8个队列"><a href="#75个线程-消息3K-8个队列" class="headerlink" title="75个线程 消息3K 8个队列"></a>75个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 75 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 102311 Max RT: 370 Average RT: 0.733 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 93722 Max RT: 370 Average RT: 0.800 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 101091 Max RT: 370 Average RT: 0.742 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 100404 Max RT: 370 Average RT: 0.747 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 102328 Max RT: 370 Average RT: 0.733 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 103953 Max RT: 370 Average RT: 0.722 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 103454 Max RT: 370 Average RT: 0.725 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="75个线程-消息1K-16个队列"><a href="#75个线程-消息1K-16个队列" class="headerlink" title="75个线程 消息1K 16个队列"></a>75个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 75 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 106813 Max RT: 605 Average RT: 0.687 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 110828 Max RT: 605 Average RT: 0.673 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 109855 Max RT: 605 Average RT: 0.676 Send Failed: 0 Response Failed: 3</span><br><span class="line"></span><br><span class="line">Send TPS: 102741 Max RT: 605 Average RT: 0.730 Send Failed: 0 Response Failed: 3</span><br><span class="line"></span><br><span class="line">Send TPS: 110123 Max RT: 605 Average RT: 0.681 Send Failed: 0 Response Failed: 3</span><br><span class="line"></span><br><span class="line">Send TPS: 115659 Max RT: 605 Average RT: 0.648 Send Failed: 0 Response Failed: 3</span><br><span class="line"></span><br><span class="line">Send TPS: 108157 Max RT: 605 Average RT: 0.693 Send Failed: 0 Response Failed: 3</span><br></pre></td></tr></table></figure>



<h3 id="75个线程-消息3K-16个队列"><a href="#75个线程-消息3K-16个队列" class="headerlink" title="75个线程 消息3K 16个队列"></a>75个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 75 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 90459 Max RT: 499 Average RT: 0.829 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 96838 Max RT: 499 Average RT: 0.770 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 96590 Max RT: 499 Average RT: 0.776 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 95137 Max RT: 499 Average RT: 0.788 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 89502 Max RT: 499 Average RT: 0.834 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 90255 Max RT: 499 Average RT: 0.831 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 99871 Max RT: 499 Average RT: 0.725 Send Failed: 0 Response Failed: 9</span><br></pre></td></tr></table></figure>



<h1 id="100个线程测试记录"><a href="#100个线程测试记录" class="headerlink" title="100个线程测试记录"></a>100个线程测试记录</h1><h3 id="100个线程-消息1K-8个队列"><a href="#100个线程-消息1K-8个队列" class="headerlink" title="100个线程 消息1K 8个队列"></a>100个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 100 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 113204 Max RT: 402 Average RT: 0.883 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 114872 Max RT: 402 Average RT: 0.868 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 116261 Max RT: 402 Average RT: 0.860 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 118116 Max RT: 402 Average RT: 0.847 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 112594 Max RT: 402 Average RT: 0.888 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 124407 Max RT: 402 Average RT: 0.801 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 126590 Max RT: 402 Average RT: 0.790 Send Failed: 0 Response Failed: 2</span><br></pre></td></tr></table></figure>



<h3 id="100个线程-消息3K-8个队列"><a href="#100个线程-消息3K-8个队列" class="headerlink" title="100个线程 消息3K 8个队列"></a>100个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 100 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 106723 Max RT: 426 Average RT: 0.937 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 104768 Max RT: 426 Average RT: 0.943 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 106697 Max RT: 426 Average RT: 0.935 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 105147 Max RT: 426 Average RT: 0.951 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 105814 Max RT: 426 Average RT: 0.935 Send Failed: 0 Response Failed: 5</span><br><span class="line"></span><br><span class="line">Send TPS: 108616 Max RT: 426 Average RT: 0.916 Send Failed: 0 Response Failed: 6</span><br><span class="line"></span><br><span class="line">Send TPS: 101429 Max RT: 426 Average RT: 0.986 Send Failed: 0 Response Failed: 6</span><br></pre></td></tr></table></figure>



<h3 id="100个线程-消息1K-16个队列"><a href="#100个线程-消息1K-16个队列" class="headerlink" title="100个线程 消息1K 16个队列"></a>100个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 100 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 123424 Max RT: 438 Average RT: 0.805 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 111418 Max RT: 438 Average RT: 0.897 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 110360 Max RT: 438 Average RT: 0.905 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 118734 Max RT: 438 Average RT: 0.842 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 120725 Max RT: 438 Average RT: 0.816 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 113823 Max RT: 438 Average RT: 0.878 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 115639 Max RT: 438 Average RT: 0.865 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 112787 Max RT: 438 Average RT: 0.889 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 106677 Max RT: 438 Average RT: 0.937 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 112635 Max RT: 438 Average RT: 0.888 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 108470 Max RT: 438 Average RT: 0.922 Send Failed: 0 Response Failed: 4</span><br></pre></td></tr></table></figure>



<h3 id="100个线程-消息3K-16个队列"><a href="#100个线程-消息3K-16个队列" class="headerlink" title="100个线程 消息3K 16个队列"></a>100个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 100 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 93374 Max RT: 441 Average RT: 1.071 Send Failed: 0 Response Failed: 3</span><br><span class="line"></span><br><span class="line">Send TPS: 98421 Max RT: 441 Average RT: 1.017 Send Failed: 0 Response Failed: 3</span><br><span class="line"></span><br><span class="line">Send TPS: 103664 Max RT: 441 Average RT: 0.964 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 98234 Max RT: 441 Average RT: 0.995 Send Failed: 0 Response Failed: 6</span><br><span class="line"></span><br><span class="line">Send TPS: 103563 Max RT: 441 Average RT: 0.960 Send Failed: 0 Response Failed: 7</span><br><span class="line"></span><br><span class="line">Send TPS: 103807 Max RT: 441 Average RT: 0.962 Send Failed: 0 Response Failed: 7</span><br><span class="line"></span><br><span class="line">Send TPS: 102715 Max RT: 441 Average RT: 0.973 Send Failed: 0 Response Failed: 7</span><br></pre></td></tr></table></figure>



<h1 id="150个线程测试记录"><a href="#150个线程测试记录" class="headerlink" title="150个线程测试记录"></a>150个线程测试记录</h1><h3 id="150个线程-消息1K-8个队列"><a href="#150个线程-消息1K-8个队列" class="headerlink" title="150个线程 消息1K 8个队列"></a>150个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 150 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 124458 Max RT: 633 Average RT: 1.205 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 124567 Max RT: 633 Average RT: 1.204 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 121324 Max RT: 633 Average RT: 1.236 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 124928 Max RT: 633 Average RT: 1.201 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 122830 Max RT: 633 Average RT: 1.242 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 118825 Max RT: 633 Average RT: 1.262 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 124085 Max RT: 633 Average RT: 1.209 Send Failed: 0 Response Failed: 0</span><br></pre></td></tr></table></figure>



<h3 id="150个线程-消息3K-8个队列"><a href="#150个线程-消息3K-8个队列" class="headerlink" title="150个线程 消息3K 8个队列"></a>150个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 150 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 106575 Max RT: 582 Average RT: 1.404 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 101830 Max RT: 582 Average RT: 1.477 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 99666 Max RT: 582 Average RT: 1.505 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 102139 Max RT: 582 Average RT: 1.465 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 105405 Max RT: 582 Average RT: 1.419 Send Failed: 0 Response Failed: 3</span><br><span class="line"></span><br><span class="line">Send TPS: 107032 Max RT: 582 Average RT: 1.399 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 103416 Max RT: 582 Average RT: 1.448 Send Failed: 0 Response Failed: 5</span><br></pre></td></tr></table></figure>



<h3 id="150个线程-消息1K-16个队列"><a href="#150个线程-消息1K-16个队列" class="headerlink" title="150个线程 消息1K 16个队列"></a>150个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 150 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 115151 Max RT: 574 Average RT: 1.299 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 106960 Max RT: 574 Average RT: 1.402 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 116382 Max RT: 574 Average RT: 1.289 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 110587 Max RT: 574 Average RT: 1.349 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 122832 Max RT: 574 Average RT: 1.220 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 124474 Max RT: 574 Average RT: 1.213 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 112153 Max RT: 574 Average RT: 1.337 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 120450 Max RT: 574 Average RT: 1.261 Send Failed: 0 Response Failed: 4</span><br></pre></td></tr></table></figure>



<h3 id="150个线程-消息3K-16个队列"><a href="#150个线程-消息3K-16个队列" class="headerlink" title="150个线程 消息3K 16个队列"></a>150个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 150 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 105061 Max RT: 535 Average RT: 1.428 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 102117 Max RT: 535 Average RT: 1.465 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 105569 Max RT: 535 Average RT: 1.421 Send Failed: 0 Response Failed: 1</span><br><span class="line"></span><br><span class="line">Send TPS: 100689 Max RT: 535 Average RT: 1.489 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 108464 Max RT: 535 Average RT: 1.381 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 111285 Max RT: 535 Average RT: 1.348 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 103406 Max RT: 535 Average RT: 1.451 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 109203 Max RT: 535 Average RT: 1.388 Send Failed: 0 Response Failed: 2</span><br></pre></td></tr></table></figure>



<h1 id="200个线程测试记录"><a href="#200个线程测试记录" class="headerlink" title="200个线程测试记录"></a>200个线程测试记录</h1><h3 id="200个线程-消息1K-8个队列"><a href="#200个线程-消息1K-8个队列" class="headerlink" title="200个线程 消息1K 8个队列"></a>200个线程 消息1K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 200 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 117965 Max RT: 628 Average RT: 1.674 Send Failed: 0 Response Failed: 7</span><br><span class="line"></span><br><span class="line">Send TPS: 115583 Max RT: 628 Average RT: 1.715 Send Failed: 0 Response Failed: 12</span><br><span class="line"></span><br><span class="line">Send TPS: 118732 Max RT: 628 Average RT: 1.672 Send Failed: 0 Response Failed: 16</span><br><span class="line"></span><br><span class="line">Send TPS: 126170 Max RT: 628 Average RT: 1.582 Send Failed: 0 Response Failed: 17</span><br><span class="line"></span><br><span class="line">Send TPS: 116203 Max RT: 628 Average RT: 1.719 Send Failed: 0 Response Failed: 18</span><br><span class="line"></span><br><span class="line">Send TPS: 114793 Max RT: 628 Average RT: 1.739 Send Failed: 0 Response Failed: 19</span><br></pre></td></tr></table></figure>



<h3 id="200个线程-消息3K-8个队列"><a href="#200个线程-消息3K-8个队列" class="headerlink" title="200个线程 消息3K 8个队列"></a>200个线程 消息3K 8个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst8 -w 200 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 107240 Max RT: 761 Average RT: 1.865 Send Failed: 0 Response Failed: 0</span><br><span class="line"></span><br><span class="line">Send TPS: 104585 Max RT: 761 Average RT: 1.906 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 110892 Max RT: 761 Average RT: 1.803 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 105414 Max RT: 761 Average RT: 1.898 Send Failed: 0 Response Failed: 2</span><br><span class="line"></span><br><span class="line">Send TPS: 105904 Max RT: 761 Average RT: 1.885 Send Failed: 0 Response Failed: 3</span><br><span class="line"></span><br><span class="line">Send TPS: 110748 Max RT: 761 Average RT: 1.806 Send Failed: 0 Response Failed: 3</span><br></pre></td></tr></table></figure>



<h3 id="200个线程-消息1K-16个队列"><a href="#200个线程-消息1K-16个队列" class="headerlink" title="200个线程 消息1K 16个队列"></a>200个线程 消息1K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 200 -s 1024 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 118892 Max RT: 601 Average RT: 1.679 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 118839 Max RT: 601 Average RT: 1.668 Send Failed: 0 Response Failed: 12</span><br><span class="line"></span><br><span class="line">Send TPS: 117122 Max RT: 601 Average RT: 1.704 Send Failed: 0 Response Failed: 12</span><br><span class="line"></span><br><span class="line">Send TPS: 122670 Max RT: 601 Average RT: 1.630 Send Failed: 0 Response Failed: 12</span><br><span class="line"></span><br><span class="line">Send TPS: 119592 Max RT: 601 Average RT: 1.672 Send Failed: 0 Response Failed: 12</span><br><span class="line"></span><br><span class="line">Send TPS: 121243 Max RT: 601 Average RT: 1.649 Send Failed: 0 Response Failed: 12</span><br><span class="line"></span><br><span class="line">Send TPS: 124760 Max RT: 601 Average RT: 1.603 Send Failed: 0 Response Failed: 12</span><br><span class="line"></span><br><span class="line">Send TPS: 124354 Max RT: 601 Average RT: 1.608 Send Failed: 0 Response Failed: 12</span><br><span class="line"></span><br><span class="line">Send TPS: 119272 Max RT: 601 Average RT: 1.677 Send Failed: 0 Response Failed: 12</span><br></pre></td></tr></table></figure>



<h3 id="200个线程-消息3K-16个队列"><a href="#200个线程-消息3K-16个队列" class="headerlink" title="200个线程 消息3K 16个队列"></a>200个线程 消息3K 16个队列</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh producer.sh -t zms-clusterB-perf-tst16 -w 200 -s 3072 -n 192.168.x.x:9876</span><br><span class="line"></span><br><span class="line">Send TPS: 105091 Max RT: 963 Average RT: 1.896 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 106243 Max RT: 963 Average RT: 1.882 Send Failed: 0 Response Failed: 4</span><br><span class="line"></span><br><span class="line">Send TPS: 103994 Max RT: 963 Average RT: 1.958 Send Failed: 0 Response Failed: 5</span><br><span class="line"></span><br><span class="line">Send TPS: 109741 Max RT: 963 Average RT: 1.822 Send Failed: 0 Response Failed: 5</span><br><span class="line"></span><br><span class="line">Send TPS: 103788 Max RT: 963 Average RT: 1.927 Send Failed: 0 Response Failed: 5</span><br><span class="line"></span><br><span class="line">Send TPS: 110597 Max RT: 963 Average RT: 1.805 Send Failed: 0 Response Failed: 6</span><br><span class="line"></span><br><span class="line">Send TPS: 111201 Max RT: 963 Average RT: 1.798 Send Failed: 0 Response Failed: 6</span><br></pre></td></tr></table></figure>

</div>

			<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
			<script>
			var isMobile = navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);
			if (!isMobile) {
			    var btw = new BTWPlugin();
			    btw.init({
			        "id": "vip-container",
			        "blogId": "19728-1607829271089-768",
			        "name": "瓜农老梁",
			        "qrcode": "https://img-blog.csdnimg.cn/2020121311123065.jpg",
			        "keyword": "more"
			    });
			}
			</script>
		]]></content>
      <categories>
        <category>RocketMQ</category>
      </categories>
      <tags>
        <tag>RocketMQ</tag>
      </tags>
  </entry>
</search>
